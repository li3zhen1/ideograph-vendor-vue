var bn=Object.defineProperty,Sn=Object.defineProperties;var wn=Object.getOwnPropertyDescriptors;var St=Object.getOwnPropertySymbols;var Fn=Object.prototype.hasOwnProperty,Nn=Object.prototype.propertyIsEnumerable;var He=(t,e,n)=>e in t?bn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,D=(t,e)=>{for(var n in e||(e={}))Fn.call(e,n)&&He(t,n,e[n]);if(St)for(var n of St(e))Nn.call(e,n)&&He(t,n,e[n]);return t},P=(t,e)=>Sn(t,wn(e));var u=(t,e,n)=>(He(t,typeof e!="symbol"?e+"":e,n),n);import{u as kn,a as An,c as ze,b as ge,d as wt,_ as $,e as Ft,l as We,f as Nt,F as Dn,j as s,g as p,h as ke,i as In,s as B,I as Z,r as h,k as O,C as je,m as fe,n as qe,o as ee,D as re,B as me,T as Rn,M as Ge,A as Tn,p as _n,q as kt,t as Ae,v as Bn,w as On,R as te,x as Ue,y as Je,z as De,S as Pn,E as Ke,G as ye,P as ne,H as j,J as $n,K as Mn,L as Ln,N as At,O as Dt,Q as Hn,U as zn,V as xe,W as Wn,X as It,Y as Rt,Z as jn,$ as qn,a0 as Gn,a1 as Ve,a2 as Un,a3 as Jn,a4 as Kn,a5 as Vn,a6 as Xn,a7 as Qn,a8 as Yn,a9 as Zn,aa as Ie,ab as eo,ac as to,ad as Tt,ae as no,af as oo,ag as so,ah as ao}from"./vendor.f2f83d7f.js";const ro=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}};ro();const q=()=>kn(),F=An;var k;(function(t){t[t.Default=0]="Default",t[t.CreatingNode=1]="CreatingNode",t[t.CreatingEdgeFrom=2]="CreatingEdgeFrom",t[t.CreatingEdgeTo=3]="CreatingEdgeTo"})(k||(k={}));const ve=ze({selectId:t=>t.id}),io=ve.getInitialState(),_t=ge({name:"constraint",initialState:io,reducers:{addConstraint:(t,e)=>{ve.addOne(t,e)},modifyConstraint:(t,e)=>{ve.updateOne(t,e),t.lastOperation={action:"updateOne",payload:e}},deleteConstraint:(t,e)=>{ve.removeOne(t,e),t.lastOperation={action:"removeOne",payload:e}},renewal(t,e){t.ids=e.payload.ids,t.entities=e.payload.entities,t.lastOperation=void 0},addConstraintToContext:(t,e)=>{t.lastOperation={action:"addOne",payload:e}}}}),{modifyConstraint:lo,deleteConstraint:co,addConstraint:uo,addConstraintToContext:ho,renewal:Xe}=_t.actions,Ce=ve.getSelectors(t=>t.constraints),po=t=>t.constraints.lastOperation;var go=_t.reducer;const Ee=ze({selectId:t=>t.id}),Bt=ge({name:"edges",initialState:Ee.getInitialState(),reducers:{addEdge:Ee.addOne,modifyEdge:Ee.updateOne,deleteEdge:Ee.removeOne,renewal(t,e){t.ids=e.payload.ids,t.entities=e.payload.entities}}}),{addEdge:fo,modifyEdge:Wa,deleteEdge:ja,renewal:Qe}=Bt.actions,be=Ee.getSelectors(t=>t.edges);var mo=Bt.reducer,M;(function(t){t[t.Node=0]="Node",t[t.Edge=1]="Edge"})(M||(M={}));const Ye=["#2F80ED","#27AE60","#F2994A","#9B51E0","#EB5757","#F2C94C","#722ED1","#9FDB1D","#5EDFD6","#94BFFF","#57A9FB","#F979B7","#063078","#07828B","#FADC19","#5F940A","#A1151E","#FAAC7B","#165DFF","#7EB712"];class Ot{constructor(e){u(this,"_primary");u(this,"constrained");u(this,"disabled");u(this,"darkened");u(this,"foreground");u(this,"asObject",()=>({primary:this._primary,constrained:this.constrained,disabled:this.disabled,foreground:this.foreground,darkened:this.darkened}));const n=new wt(e);this._primary=e,this.constrained=n.darken(.2).saturate(.1).toString(),this.disabled=n.lighten(.2).desaturate(.2).toString(),this.darkened=n.darken(.5).desaturate(.2).toString(),this.foreground=n.darken(3).isDark()?"#fff":"#000"}get primary(){return this._primary}set primary(e){const n=new wt(e);this._primary=e,this.constrained=n.darken(.2).saturate(.1).toString(),this.disabled=n.lighten(.2).desaturate(.2).toString(),this.darkened=n.darken(.5).desaturate(.2).toString(),this.foreground=n.darken(3).isDark()?"#fff":"#000"}}var Ze;(function(t){t.String="string",t.Number="number",t.Boolean="boolean"})(Ze||(Ze={}));var Se;(function(t){t[t.Specified=0]="Specified",t[t.Unspecified=1]="Unspecified"})(Se||(Se={}));var Pt;(function(t){(function(e){e.Concept="Concept",e.Property="Property",e.Relation="Relation"})(t.NodeLabel||(t.NodeLabel={}))})(Pt||(Pt={}));const Re=async()=>(await Ft.get("/api/schema")).data,yo=(t,e)=>{const n=t.propertyNodes.map(l=>({id:l.nodeId,name:l.name,type:Ze.String})),o=t.conceptNodes.map((l,c)=>({id:l.nodeId,name:l.name,properties:[],colorSlot:new Ot(Ye[c%Ye.length]).asObject()})),a=$.keyBy(o.map((l,c)=>[l.id,c]),l=>l[0]),r=$.keyBy(n,l=>l.id);t.hasPropertyEdges.forEach(l=>{var c;(c=o[a[String(l.fromId)][1]])==null||c.properties.push(r[String(l.toId)])});const i=t.hasRelationConceptEdges.map(l=>({id:l._id,from:l.fromId,to:l.toId,direction:Se.Specified,name:l.name}));return{name:String(e),classes:o,relations:i}},we=ze({selectId:t=>t.id}),$t=ge({name:"nodes",initialState:we.getInitialState(),reducers:{addNode:we.addOne,modifyNode:we.updateOne,deleteNode:we.removeOne,renewal(t,e){t.ids=e.payload.ids,t.entities=e.payload.entities}}}),{addNode:xo,modifyNode:vo,deleteNode:qa,renewal:et}=$t.actions,oe=we.getSelectors(t=>t.nodes);var Co=$t.reducer;const ie=We.createInstance({name:"query"}),le=We.createInstance({name:"datasource"}),tt=We.createInstance({name:"history"}),Eo=async()=>(await le.getItem("162.105.88.139:27025")||le.setItem("162.105.88.139:27025",{id:"162.105.88.139:27025",name:"\u533B\u7597\u6570\u636E\u5E93",mongo:{hostAddress:"162.105.88.139",port:27025,userName:"rootxyx",password:"woxnsk!"},dgraph:{hostAddress:"162.105.88.139",port:19482}}),{query:ie,dataSource:le,patternHistory:tt}),Mt=async t=>{const n=(await t.keys()).map(async o=>await t.getItem(o));return await Promise.all(n)},bo=async t=>{const n=(await t.keys()).map(async o=>{const a=await t.getItem(o);return[o,a]});return Object.fromEntries(await Promise.all(n))},So=t=>{if(t.constraintContext)return Object.assign(t.constraintContext,{constraints:Object.values(t.constraints.entities)})},wo=async t=>{const e=await Mt(t.query),n=$.groupBy(e,a=>a.dataSourceId);return(await Mt(t.dataSource)).map(a=>{var r;return{dataSource:a,queries:(r=n[a.id])!=null?r:[]}})},K=t=>t!=null,Fo=240,Lt=200,Ht=420,No=480,ko=380,Ao=960,nt=320,zt=240,Wt=640,jt=new Date().getTime(),Do={model:null,editMode:k.CreatingNode,projectName:"",workspaceName:"",createTime:jt,lastModifiedTime:jt,leftPanelWidth:Fo,rightPanelWidth:No,bottomPanelHeight:nt,codeModalState:void 0,queryModalState:!1,dataSourceId:"",fileId:""},qt=ge({name:"workspace",initialState:Do,reducers:{setModel(t,e){t.model=e.payload},setModelBySchema(t,e){t.model=yo(e.payload)},setEditMode(t,e){e.payload!==k.CreatingNode&&(t.editPayload=void 0),t.editMode=e.payload},setWorkspaceName(t,e){t.workspaceName=e.payload},setProjectName(t,e){t.projectName=e.payload},applyQuery(t,e){t.queryModalState=e.payload},exportToJson(){},inspectGeneratedCode(t,e){},setRightPanelWidth(t,e){e.payload<=Ao&&e.payload>=ko&&(t.rightPanelWidth=e.payload)},setLeftPanelWidth(t,e){e.payload<=Ht&&e.payload>=Lt&&(t.leftPanelWidth=e.payload)},setBottomPanelHeight(t,e){e.payload<=Wt&&e.payload>=zt&&(t.bottomPanelHeight=e.payload)},setFocus(t,e){t.focusElement=e.payload},setEditModeWithPayload(t,e){e.payload.editMode===k.CreatingNode?t.editPayload=e.payload.payload:t.editPayload=void 0,t.editMode=e.payload.editMode},setEditPayloadDangerously(t,e){t.editPayload=e.payload},setCodeModal(t,e){t.codeModalState=e.payload},applyFileToWorkspace(t,e){t.projectName=e.payload.projectName,t.workspaceName=e.payload.workspaceName,t.createTime=e.payload.createTime,t.lastModifiedTime=e.payload.lastModifiedTime,t.fileId=e.payload.fileId,t.dataSourceId=e.payload.dataSourceId,t.model=null,t.editMode=k.CreatingNode,t.focusElement=void 0,t.editPayload=void 0,t.queryModalState=!1},clearWorkspace(t){t.projectName="",t.workspaceName="",t.createTime=0,t.lastModifiedTime=0,t.fileId="",t.dataSourceId="",t.model=null,t.editMode=k.CreatingNode,t.focusElement=void 0,t.editPayload=void 0,t.queryModalState=!1}}}),Gt=t=>async(e,n)=>{const o=n(),a={id:o.workspace.fileId,name:o.workspace.workspaceName,nodes:o.nodes,edges:o.edges,constraints:o.constraints,dataSourceId:o.workspace.dataSourceId,solutionCaches:[],createTime:o.workspace.createTime,lastEditTime:new Date().getTime(),constraintContext:t};ie.setItem(a.id,a),console.log(`[FileSystem] ${a.name} (${a.id}) saved at ${a.lastEditTime}.`)},Io=()=>async(t,e)=>{const n=e(),o={id:n.workspace.fileId,name:n.workspace.workspaceName,nodes:n.nodes,edges:n.edges,constraints:n.constraints,dataSourceId:n.workspace.dataSourceId,solutionCaches:[],createTime:n.workspace.createTime,lastEditTime:new Date().getTime()};var a=new Blob([JSON.stringify(o)],{type:"text/plain;charset=utf-8"});Dn.saveAs(a,`${o.name}.json`),console.log(`[FileSystem] ${o.name} (${o.id}) exported at ${o.lastEditTime}.`)},{setModel:Ro,setModelBySchema:Te,clearWorkspace:To,setEditMode:Ga,setWorkspaceName:_o,setProjectName:Ua,applyQuery:ot,exportToJson:Ja,inspectGeneratedCode:Ka,setRightPanelWidth:Bo,setLeftPanelWidth:Oo,setBottomPanelHeight:Po,setFocus:Ut,setEditModeWithPayload:$o,setEditPayloadDangerously:Jt,setCodeModal:Kt,applyFileToWorkspace:st}=qt.actions,_e=t=>t.workspace.model,Mo=t=>t.workspace.codeModalState,Lo=t=>t.workspace.queryModalState,at=t=>t.workspace.editMode,Ho=t=>t.workspace.projectName,zo=t=>t.workspace.workspaceName,Wo=t=>t.workspace.lastModifiedTime,Fe=t=>t.workspace.leftPanelWidth,rt=t=>t.workspace.rightPanelWidth,jo=t=>t.workspace.bottomPanelHeight,Vt=t=>t.workspace.focusElement,Xt=Nt(oe.selectEntities,be.selectEntities,_e,Vt,(t,e,n,o)=>{var a,r;if(!!n){if((o==null?void 0:o.type)===M.Node)return P(D({},t[o.payload.id]),{type:M.Node});if((o==null?void 0:o.type)===M.Edge){const i=(a=t[o.payload.from])==null?void 0:a.class.id,l=(r=t[o.payload.to])==null?void 0:r.class.id;if(K(i)&&K(l)){const c=n.relations.filter(d=>d.from===i&&d.to===l);return P(D({},e[o.payload.id]),{type:M.Edge,class:P(D({},e[o.payload.id].class),{properties:c.flatMap(d=>d.properties).filter(d=>d!==void 0)})})}return P(D({},t[o.payload.id]),{type:M.Node})}else return}}),qo=Nt(Ce.selectAll,Vt,(t,e)=>t.filter(n=>n.targetId===(e==null?void 0:e.payload.id))),Qt=t=>t.workspace.editPayload;var Go=qt.reducer;const Uo=new Intl.DateTimeFormat("zh-Hans-CN"),R="\u2E80-\u2EFF\u2F00-\u2FDF\u3040-\u309F\u30A0-\u30FA\u30FC-\u30FF\u3100-\u312F\u3200-\u32FF\u3400-\u4DBF\u4E00-\u9FFF\uF900-\uFAFF",Jo=new RegExp(`[${R}]`),Ko=new RegExp(`([${R}])[ ]*([\\:]+|\\.)[ ]*([${R}])`,"g"),Vo=new RegExp(`([${R}])[ ]*([~\\!;,\\?]+)[ ]*`,"g"),Xo=new RegExp(`([\\.]{2,}|\u2026)([${R}])`,"g"),Qo=new RegExp(`([${R}])\\:([A-Z0-9\\(\\)])`,"g"),Yo=new RegExp(`([${R}])([\`"\u05F4])`,"g"),Zo=new RegExp(`([\`"\u05F4])([${R}])`,"g"),es=/([`"\u05f4]+)[ ]*(.+?)[ ]*([`"\u05f4]+)/g,ts=new RegExp(`([${R}])('[^s])`,"g"),ns=new RegExp(`(')([${R}])`,"g"),os=new RegExp(`([A-Za-z0-9${R}])( )('s)`,"g"),ss=new RegExp(`([${R}])(#)([${R}]+)(#)([${R}])`,"g"),as=new RegExp(`([${R}])(#([^ ]))`,"g"),rs=new RegExp(`(([^ ])#)([${R}])`,"g"),is=new RegExp(`([${R}])([\\+\\-\\*\\/=&\\|<>])([A-Za-z0-9])`,"g"),ls=new RegExp(`([A-Za-z0-9])([\\+\\-\\*\\/=&\\|<>])([${R}])`,"g"),ds=/([/]) ([a-z\-_\./]+)/g,cs=/([/\.])([A-Za-z\-_\./]+) ([/])/g,us=new RegExp(`([${R}])([\\(\\[\\{<>\u201C])`,"g"),hs=new RegExp(`([\\)\\]\\}<>\u201D])([${R}])`,"g"),ps=/([\(\[\{<\u201c]+)[ ]*(.+?)[ ]*([\)\]\}>\u201d]+)/,gs=new RegExp(`([A-Za-z0-9${R}])[ ]*([\u201C])([A-Za-z0-9${R}\\-_ ]+)([\u201D])`,"g"),fs=new RegExp(`([\u201C])([A-Za-z0-9${R}\\-_ ]+)([\u201D])[ ]*([A-Za-z0-9${R}])`,"g"),ms=/([A-Za-z0-9])([\(\[\{])/g,ys=/([\)\]\}])([A-Za-z0-9])/g,xs=new RegExp(`([${R}])([A-Za-z\u0370-\u03FF0-9@\\$%\\^&\\*\\-\\+\\\\=\\|/\xA1-\xFF\u2150-\u218F\u2700\u2014\u27BF])`,"g"),vs=new RegExp(`([A-Za-z\u0370-\u03FF0-9~\\$%\\^&\\*\\-\\+\\\\=\\|/!;:,\\.\\?\xA1-\xFF\u2150-\u218F\u2700\u2014\u27BF])([${R}])`,"g"),Cs=/(%)([A-Za-z])/g,Es=/([ ]*)([\u00b7\u2022\u2027])([ ]*)/g;class bs{constructor(){u(this,"version","4.0.7-thin")}convertToFullwidth(e){return e.replace(/~/g,"\uFF5E").replace(/!/g,"\uFF01").replace(/;/g,"\uFF1B").replace(/:/g,"\uFF1A").replace(/,/g,"\uFF0C").replace(/\./g,"\u3002").replace(/\?/g,"\uFF1F")}spacing(e){if(typeof e!="string")return console.warn(`spacing(text) only accepts string but got ${typeof e}`),e;if(e.length<=1||!Jo.test(e))return e;const n=this;let o=e;return o=o.replace(Ko,(a,r,i,l)=>{const c=n.convertToFullwidth(i);return`${r}${c}${l}`}),o=o.replace(Vo,(a,r,i)=>{const l=n.convertToFullwidth(i);return`${r}${l}`}),o=o.replace(Xo,"$1\u2009$2"),o=o.replace(Qo,"$1\uFF1A$2"),o=o.replace(Yo,"$1\u2009$2"),o=o.replace(Zo,"$1\u2009$2"),o=o.replace(es,"$1$2$3"),o=o.replace(ts,"$1\u2009$2"),o=o.replace(ns,"$1\u2009$2"),o=o.replace(os,"$1's"),o=o.replace(ss,"$1\u2009$2$3$4\u2009$5"),o=o.replace(as,"$1\u2009$2"),o=o.replace(rs,"$1\u2009$3"),o=o.replace(is,"$1\u2009$2\u2009$3"),o=o.replace(ls,"$1\u2009$2\u2009$3"),o=o.replace(ds,"$1$2"),o=o.replace(cs,"$1$2$3"),o=o.replace(us,"$1\u2009$2"),o=o.replace(hs,"$1\u2009$2"),o=o.replace(ps,"$1$2$3"),o=o.replace(gs,"$1\u2009$2$3$4"),o=o.replace(fs,"$1$2$3\u2009$4"),o=o.replace(ms,"$1\u2009$2"),o=o.replace(ys,"$1\u2009$2"),o=o.replace(xs,"$1\u2009$2"),o=o.replace(vs,"$1\u2009$2"),o=o.replace(Cs,"$1\u2009$2"),o=o.replace(Es,"\u30FB"),o}spacingText(e,n=()=>{}){let o;try{o=this.spacing(e)}catch(a){console.error(a)}n()}spacingTextSync(e){return this.spacing(e)}}const X=new bs,G=t=>{const e=X.spacing(t.children);return s("span",P(D({},t),{children:e}))};const Ss=t=>s("div",{className:"contextual-callout-root",children:t.groups.map((e,n)=>{const o=e.map(a=>{var r;return a.onRenderContent?s("div",{className:"contextual-callout-free",children:a.onRenderContent()},a.text):p("div",{className:"contextual-callout-item",onClick:a.onClick,style:{pointerEvents:a.onClick?void 0:"none"},children:[s(G,{children:a.text}),s("span",{className:"contextual-callout-item-helper",children:(r=a.onRenderHelper)==null?void 0:r.call(a)})]},a.text)});return n===t.groups.length-1?o:o.concat(s("div",{className:"contextual-callout-sep"},n))})}),de={fontFamily:"var(--display-font)",letterSpacing:"-0.025em"},Be={large:{fontFamily:"var(--display-font)"},xLarge:de,xxLarge:de,xLargePlus:de,xxLargePlus:de,superLarge:de,mega:de};ke({palette:{themePrimary:"#1870fb",themeLighterAlt:"#01040a",themeLighter:"#041228",themeLight:"#07214b",themeTertiary:"#0f4396",themeSecondary:"#1662dc",themeDarkAlt:"#307dfa",themeDark:"#4f91fb",themeDarker:"#7daefc",neutralLighterAlt:"#ffffff",neutralLighter:"#ffffff",neutralLight:"#ffffff",neutralQuaternaryAlt:"#ffffff",neutralQuaternary:"#ffffff",neutralTertiaryAlt:"#ffffff",neutralTertiary:"#0b0b0e",neutralSecondary:"#0e0f12",neutralPrimaryAlt:"#111217",neutralPrimary:"#20222a",neutralDark:"#181a20",black:"#1c1d24",white:"#ffffff"},defaultFontStyle:{fontFamily:"var(--font)"},fonts:Be});ke({palette:{themePrimary:"#1870fb",themeLighterAlt:"#01040a",themeLighter:"#041228",themeLight:"#07214b",themeTertiary:"#0f4396",themeSecondary:"#1662dc",themeDarkAlt:"#307dfa",themeDark:"#4f91fb",themeDarker:"#7daefc",neutralLighterAlt:"#ffffff",neutralLighter:"#ffffff",neutralLight:"#ffffff",neutralQuaternaryAlt:"#ffffff",neutralQuaternary:"#ffffff",neutralTertiaryAlt:"#ffffff",neutralTertiary:"#0b0b0e",neutralSecondary:"#0e0f12",neutralPrimaryAlt:"#111217",neutralPrimary:"#20222a",neutralDark:"#181a20",black:"#1c1d24",white:"#ffffff"},defaultFontStyle:{fontFamily:"var(--mono-font)"},fonts:Be});const Y=ke({palette:{themePrimary:"#1870fb",themeLighterAlt:"#f6f9ff",themeLighter:"#dae8fe",themeLight:"#b9d3fd",themeTertiary:"#74a8fc",themeSecondary:"#3480fb",themeDarkAlt:"#1664e1",themeDark:"#1355be",themeDarker:"#0e3e8c",neutralLighterAlt:"#272932",neutralLighter:"#2e303a",neutralLight:"#393c48",neutralQuaternaryAlt:"#414450",neutralQuaternary:"#474a57",neutralTertiaryAlt:"#626574",neutralTertiary:"#c8c8c8",neutralSecondary:"#d0d0d0",neutralPrimaryAlt:"#dadada",neutralPrimary:"#ffffff",neutralDark:"#f4f4f4",black:"#f8f8f8",white:"#20222a"},defaultFontStyle:{fontFamily:"var(--font)"},fonts:Be}),Yt=ke({palette:{themePrimary:"#ffffff",themeLighterAlt:"#767676",themeLighter:"#a6a6a6",themeLight:"#c8c8c8",themeTertiary:"#d0d0d0",themeSecondary:"#dadada",themeDarkAlt:"#eaeaea",themeDark:"#f4f4f4",themeDarker:"#f8f8f8",neutralLighterAlt:"#186cf3",neutralLighter:"#186aef",neutralLight:"#1766e5",neutralQuaternaryAlt:"#155fd6",neutralQuaternary:"#145bcc",neutralTertiaryAlt:"#1457c4",neutralTertiary:"#a7aab6",neutralSecondary:"#8d919f",neutralPrimaryAlt:"#757987",neutralPrimary:"#20222a",neutralDark:"#474b58",black:"#333540",white:"#1870fb"},defaultFontStyle:{fontFamily:"var(--font)"},fonts:Be}),it={theme:Y,beakWidth:8,styles:{beakCurtain:{borderRadius:0}},dismissOnTargetClick:!0},ws=In({transitions:{create:()=>"none"},typography:{fontFamily:"var(--font)"},components:{MuiButtonBase:{defaultProps:{disableRipple:!0}}}}),Fs={root:{height:48,padding:0,margin:0,minWidth:0},flexContainer:{padding:0,minWidth:0,width:24},label:{padding:0,margin:0}},Ns=B(Z)(t=>({color:"#fff",minWidth:0,textAlign:"center",width:200,flex:"1 1 auto",padding:0,height:"48px",verticalAlign:"bottom",display:"inline-block",font:"var(--font)","&>input":{minWidth:0,textAlign:"center",height:"100%",padding:0,fontSize:14}})),ks=t=>{const[e,n]=h.exports.useState(!1),[o,a]=h.exports.useState(!1),r=h.exports.useRef(null),i=h.exports.useRef(null),[l,c]=h.exports.useState(t.value);return p(O,{children:[!e&&p(O,{children:[s(G,{style:{color:"#aaa",margin:"0 8px",padding:"0 8px"},children:t.projectName}),s("svg",{className:"svg",width:"9",height:"18",viewBox:"0 0 9 18",xmlns:"http://www.w3.org/2000/svg",children:s("path",{d:"M1.032 16.825l6-16 .936.35-6 16-.936-.35z",fillRule:"nonzero",fillOpacity:"1",fill:"#aaa",stroke:"none"})})]}),e&&s(Ns,{value:l,onChange:d=>c(d.target.value),onBlur:d=>{n(!1),t.onSetName(l)},onKeyDown:d=>{d.key==="Enter"&&n(!1)},onFocus:d=>{d.target.select()},onMouseUp:d=>{d.target.select()},autoFocus:!0,ref:i}),!e&&p(O,{children:[s("div",{style:{marginLeft:16,marginRight:4},onClick:d=>{n(!0),a(!1)},children:X.spacing(t.value)}),s(je,{onClickAway:d=>a(!1),children:s(fe,{elementRef:r,onClick:d=>{a(!0)},styles:Fs,theme:Y,children:s(qe,{})})}),o&&s(ee,P(D({},it),{target:r.current,directionalHint:re.bottomCenter,onClick:()=>{a(!1)},children:t.onRenderCallout()}))]})]})},Zt={root:{height:48,aspectRatio:"1 / 1",padding:0,margin:0}},en={root:{height:32,padding:"0 16px",margin:"8px 0",borderRadius:3},flexContainer:{flexDirection:"row-reverse"},label:{padding:"0 0 0 8px",margin:0}};B(me)(t=>({height:48,aspectRatio:"1 / 1",padding:0,margin:0}));const Oe=t=>t.hint||t.shortcut?s(Rn,{content:p("span",{className:"general-tooltip",children:[t.hint,p("span",{className:"keyboard-shortcut",children:[t.cmd&&p(O,{children:[s(Ge,{}),s(Tn,{})]}),t.shortcut]})]}),theme:Y,directionalHint:re.topCenter,delay:_n.long,calloutProps:it,children:s(fe,P(D({},t),{styles:t.autoLength?en:Zt,theme:t.activated||t.forcedHighlight?Yt:Y,children:t.children}))}):s(fe,P(D({},t),{styles:t.autoLength?en:Zt,theme:t.activated||t.forcedHighlight?Yt:Y,children:t.children}));const lt={backgroundColor:"var(--grey700)",padding:"2px 4px",borderRadius:2,color:"#000"},As=t=>{const e=F(at),n=F(Ho),o=F(zo),a=F(Wo),r=F(oe.selectTotal),i=F(be.selectTotal),l=F(Ce.selectTotal),c=q();kt(X.spacing(`${o}\u2009-\u2009Ideograph`));const d=Ae();return p("div",{className:"ideograph-header",children:[s("div",{style:{height:"100%",width:"100%",display:"flex",alignItems:"center",paddingLeft:4},children:s(Oe,{activated:e===k.Default,onClick:g=>d("/"),children:s(Bn,{})})}),s("div",{style:{height:"100%",width:"100%",display:"flex",alignItems:"center"},children:s(ks,{projectName:n,value:o,onSetName:g=>{g&&c(_o(g))},onRenderCallout:()=>s(O,{children:s(Ss,{groups:[[{onRenderContent:()=>p("span",{style:{color:"var(--grey700)"},children:["\u6700\u540E\u4FEE\u6539\u65F6\u95F4  ",Uo.format(a)]}),text:"time"},{onRenderContent:()=>p("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",columnGap:24},children:[s(G,{style:lt,children:r+"\u4E2A\u70B9"}),s(G,{style:lt,children:i+"\u6761\u8FB9"}),s(G,{style:lt,children:l+"\u4E2A\u7EA6\u675F"})]}),text:"meta"}],[{text:"\u5BFC\u51FA\u4E3AJSON\u6587\u4EF6",onRenderHelper:()=>p(O,{children:[s("span",{}),s(Ge,{}),"E"]}),onClick:()=>{c(Io())}}],[{text:"\u751F\u6210JSON\u67E5\u8BE2\u8BED\u53E5",onRenderHelper:()=>p(O,{children:[s(Ge,{}),s(On,{}),"J"]}),onClick:()=>{c(Kt("JSON"))}}]]})})})}),s("div",{style:{height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:8}})]})};const Ds=t=>p("div",{className:t.topBordered?"panel-title-root panel-title-tb":"panel-title-root",style:{color:t.dimmed?"var(--grey200)":void 0,paddingTop:t.topUnpadded?0:void 0},children:[s(G,{children:t.text}),t.children]}),J=te.memo(Ds),Is={[k.Default]:"\u9009\u62E9\u548C\u79FB\u52A8",[k.CreatingNode]:"\u6DFB\u52A0\u6982\u5FF5",[k.CreatingEdgeFrom]:"\u6DFB\u52A0\u5173\u7CFB\u7EA6\u675F",[k.CreatingEdgeTo]:"\u6DFB\u52A0\u5173\u7CFB\u7EA6\u675F"},Rs=t=>p("div",{className:"ontology-create-button",style:D({display:"flex",alignItems:"center",justifyContent:"space-between",height:40,fontSize:14,cursor:"pointer"},t.style),onClick:t.onClick,children:[p("div",{style:{display:"grid",height:40,alignItems:"center",padding:0,gridTemplateColumns:"16px 24px 1fr",width:"calc(100% - 40px)"},children:[s(fe,{style:{height:40,width:16,minWidth:0,padding:0,visibility:"hidden"},children:s(qe,{})}),s("svg",{width:24,height:40,children:s("circle",{cx:8,cy:20,r:8,fill:t.item.colorSlot.primary})}),s("div",{className:"truncate",style:{width:"100%"},children:t.item.name})]}),s(fe,{style:{height:40,width:40,minWidth:0,visibility:"hidden"},children:s(Ue,{})})]},t.item.name),Ts=()=>{const t=q(),e=F(at),n=F(_e),o=F(Qt);return p("div",{children:[s(J,{text:Is[e]}),e===k.CreatingNode&&s("div",{children:n==null?void 0:n.classes.map(a=>s(Rs,{item:a,style:{backgroundColor:o===a.id?"rgba(24, 112, 251, 0.125)!important":void 0},onClick:r=>{t($o({editMode:k.CreatingNode,payload:a.id}))}},a.id))}),e>=2&&s("div",{className:"panel-desc",children:"\u4F9D\u6B21\u70B9\u51FB\u753B\u5E03\u4E2D\u9700\u8981\u8FDE\u63A5\u7684\u6982\u5FF5\u6765\u6DFB\u52A0\u5173\u7CFB\u7EA6\u675F\u3002"})]})},_s={left:Lt,right:Ht},Bs=t=>{const e=F(Fe),n=q(),o=h.exports.useRef(null),[a,r]=h.exports.useState(!1);h.exports.useEffect(()=>{a?document.body.className="cursor-ew":document.body.className=""},[a]);const i=h.exports.useMemo(()=>s(Ts,{}),[]);return p("div",{className:"concept-panel-root panel",ref:o,style:{width:e},children:[i,s(Je,{axis:"x",onDrag:(l,c)=>{n(Oo(c.x))},onStart:()=>{r(!0)},onStop:(l,c)=>{r(!1)},bounds:_s,position:{x:e,y:0},children:s("div",{className:"concept-panel-handler",style:{backgroundColor:a?"var(--primary)":void 0}})})]})};var b;(function(t){t[t.Equal=0]="Equal",t[t.Less=1]="Less",t[t.Greater=2]="Greater",t[t.LessOrEqual=3]="LessOrEqual",t[t.GreaterOrEqual=4]="GreaterOrEqual",t[t.NotEqual=5]="NotEqual",t[t.MatchRegex=6]="MatchRegex"})(b||(b={}));var U;(function(t){t[t.And=16]="And",t[t.Or=17]="Or"})(U||(U={}));var V;(function(t){t[t.Not=18]="Not"})(V||(V={}));B(De)(t=>({minWidth:0,height:"100%",aspectRatio:"1 / 1",width:"auto","&:hover":{backgroundColor:"var(--grey50)"},"&:active":{backgroundColor:"var(--grey100)"}}));const Q=B(De)(t=>({minWidth:0,aspectRatio:"1 / 1",width:32,height:32,"&:hover":{backgroundColor:"var(--grey50)"},"&:active":{backgroundColor:"var(--grey100)"},borderRadius:3})),Os=B(De)(t=>({minWidth:0,aspectRatio:"1 / 1",width:32,height:32,"&:hover":{backgroundColor:"#ffffff40"},"&:active":{backgroundColor:"#ffffff60"},borderRadius:3})),Ps=B(Z)(t=>({backgroundColor:"#fff",width:"100%",height:36,padding:"4px 8px",fontSize:14,border:"1px solid transparent",borderRadius:3,"&.Mui-focused":{},"&>input":{padding:"4px 0"}})),se=B(Z)(t=>({backgroundColor:"var(--grey50)",width:"100%",height:36,padding:"4px 8px",fontSize:13,border:"1px solid transparent",borderRadius:3,"&.Mui-focused":{border:"1px solid var(--primary)"},"&>input":{padding:"4px 0 4px 0!important"}}));B(Pn)(t=>({backgroundColor:"var(--grey50)",width:"100%",height:36,padding:"4px 8px",fontSize:13,border:"1px solid transparent",borderRadius:3,"&.Mui-focused":{border:"1px solid var(--primary)"},"&>input":{padding:"4px 0"}}));const Pe=B(me)(t=>({minHeight:0,backgroundColor:"var(--primary)",padding:"0 16px",minWidth:0,borderRadius:3,fontSize:13,height:36,color:"#fff",lineHeight:1,"&:hover":{backgroundColor:"var(--primary-darken)"}})),Ne=B(me)(t=>({minHeight:0,backgroundColor:"var(--grey50)",padding:"0 16px",minWidth:0,borderRadius:3,fontSize:13,height:36,color:"#000",lineHeight:1,"&:hover":{backgroundColor:"var(--grey100)"}})),$s={[b.Equal]:"==",[b.GreaterOrEqual]:">=",[b.LessOrEqual]:"<=",[b.Greater]:">",[b.Less]:"<",[b.NotEqual]:"!=",[b.MatchRegex]:"~="},Ms={[b.Equal]:"\u7B49\u4E8E",[b.GreaterOrEqual]:"\u5927\u4E8E\u7B49\u4E8E",[b.LessOrEqual]:"\u5C0F\u4E8E\u7B49\u4E8E",[b.Greater]:"\u5927\u4E8E",[b.Less]:"\u5C0F\u4E8E",[b.NotEqual]:"\u4E0D\u7B49\u4E8E",[b.MatchRegex]:"\u5339\u914D\u6B63\u5219\u8868\u8FBE\u5F0F"},Ls={string:[b.Equal,b.NotEqual,b.MatchRegex],number:[b.Equal,b.Less,b.LessOrEqual,b.Greater,b.GreaterOrEqual,b.NotEqual],boolean:[b.Equal,b.NotEqual]},Hs=t=>{var E,L,W,H;const e=h.exports.useRef(null),n=h.exports.useRef(null),o=h.exports.useRef(null),a=h.exports.useRef(null),[r,i]=h.exports.useState(!1),[l,c]=h.exports.useState(!1);h.exports.useState(!1);const[d,g]=h.exports.useState((E=t.constraint)==null?void 0:E.property),[x,C]=h.exports.useState((L=t.constraint)==null?void 0:L.operator);h.exports.useState((W=t.constraint)==null?void 0:W.value);const{getInputProps:f,getListboxProps:m,getOptionProps:N,groupedOptions:S}=Ke({id:"use-autocomplete-prop",options:t.class.properties,getOptionLabel:T=>T.name,defaultValue:d});return p(O,{children:[p("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",alignItems:"center",padding:"8px 8px 0 16px"},children:[s("div",{style:{display:"flex",fontWeight:600},children:"\u6DFB\u52A0\u5C5E\u6027\u7EA6\u675F"}),s("div",{style:{display:"flex",height:"100%",alignItems:"center"},children:s(Q,{onClick:t.onDismiss,children:s(ye,{})})})]}),p("div",{style:{width:360,display:"grid",gridTemplateColumns:"2fr 48px 3fr",columnGap:4,padding:16},ref:e,children:[s(se,{style:{fontFamily:"var(--mono-font)"},inputProps:f(),placeholder:"\u5C5E\u6027\u540D",onFocus:()=>{i(!0)},onBlur:()=>{i(!1)},ref:n}),s(se,{placeholder:"=",style:{fontFamily:"var(--mono-font)"},ref:o}),s(se,{placeholder:"0",style:{fontFamily:"var(--mono-font)"},ref:a})]}),p("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",columnGap:16,padding:"8px 16px 16px 16px"},children:[s(Ne,{style:{color:"red"},children:"\u53D6\u6D88"}),s(Pe,{children:"\u6DFB\u52A0"})]}),e.current&&S.length>0&&s(ne,{open:r,anchorEl:e.current,style:{width:e.current.getBoundingClientRect().width,zIndex:9999},className:"hint-root",children:s("ul",P(D({},m()),{style:{margin:0,padding:0},children:S.map((T,A)=>{const y=N({option:T,index:A});return h.exports.createElement("li",P(D({},y),{style:{fontFeatureSettings:'"liga" 1'},key:T.name,className:"constraint-intellisense-button",onClick:w=>{var v,I;g(T),(v=o.current)==null||v.focus(),(I=y.onClick)==null||I.call(y,w)}}),s("span",{children:T.name}),s("code",{style:{color:"rgb(0, 204, 175)"},className:"shimmed",children:T.type}))})}))}),e.current&&d&&s(ne,{open:l,anchorEl:e.current,style:{width:(H=e.current)==null?void 0:H.getBoundingClientRect().width},className:"hint-root",children:s("ul",{style:{margin:0,padding:0},children:Ls[d.type].map((T,A)=>p("li",{className:"constraint-intellisense-button",onPointerDown:y=>{var w;C(T),y.stopPropagation(),y.preventDefault(),(w=a.current)==null||w.focus()},children:[s("span",{style:{opacity:.25},className:"shimmed",children:d.name}),s("span",{style:{fontWeight:600},children:$s[T]}),p("span",{style:{opacity:.25},className:"shimmed",children:["(",Ms[T],")"]})]},T))})})]})},zs={string:"",number:0,boolean:!0};var tn;(function(t){t.Equals="==",t.Less="<",t.LessOrEquals="<=",t.GreaterOrEquals=">=",t.Greater=">",t.NotEquals="!=",t.Matches="~="})(tn||(tn={}));const Ws=B(Z)(({theme:t})=>({fontSize:14,fontFamily:"var(--font)",height:"100%","&>input":{padding:"4px 0 4px 0!important"}})),nn=B(Z)(({theme:t})=>({fontSize:14,fontFamily:"var(--mono-font)",height:"100%",fontFeatureSettings:'"liga" 1'})),ae={[b.Equal]:"==",[b.GreaterOrEqual]:">=",[b.LessOrEqual]:"<=",[b.Greater]:">",[b.Less]:"<",[b.NotEqual]:"!=",[b.MatchRegex]:"~="},on={[b.Equal]:"\u7B49\u4E8E",[b.GreaterOrEqual]:"\u5927\u4E8E\u7B49\u4E8E",[b.LessOrEqual]:"\u5C0F\u4E8E\u7B49\u4E8E",[b.Greater]:"\u5927\u4E8E",[b.Less]:"\u5C0F\u4E8E",[b.NotEqual]:"\u4E0D\u7B49\u4E8E",[b.MatchRegex]:"\u5339\u914D\u6B63\u5219\u8868\u8FBE\u5F0F"},dt={string:[b.Equal,b.NotEqual,b.MatchRegex],number:[b.Equal,b.Less,b.LessOrEqual,b.Greater,b.GreaterOrEqual,b.NotEqual],boolean:[b.Equal,b.NotEqual]},js=te.forwardRef((t,e)=>{var T,A,y,w;const n=h.exports.useRef(null);h.exports.useRef(null);const o=h.exports.useRef(null),a=h.exports.useRef(null),[r,i]=h.exports.useState(!1),[l,c]=h.exports.useState(!1),[d,g]=h.exports.useState(!1),[x,C]=h.exports.useState((T=t.constraint)==null?void 0:T.property),[f,m]=h.exports.useState((A=t.constraint)==null?void 0:A.operator),[N,S]=h.exports.useState((y=t.constraint)==null?void 0:y.value),{getInputProps:E,getListboxProps:L,getOptionProps:W,groupedOptions:H}=Ke({id:"use-autocomplete-prop",options:t.class.properties,getOptionLabel:v=>v.name,defaultValue:x});return h.exports.useEffect(()=>{x&&f&&!dt[x.type].includes(f)&&m(b.Equal)},[x]),h.exports.useImperativeHandle(e,()=>({getConstraintUpdate:()=>{var v,I;return x&&f&&N?{property:x,operator:f,value:N,id:(I=(v=t.constraint)==null?void 0:v.id)!=null?I:j(),targetType:M.Node,targetId:t.node.id}:{}}}),[x,f,N]),$n(()=>{!l&&!r&&!d&&x&&N&&f!==void 0&&t.onConstraintChange({operator:f,value:N,property:x})},[d,l,r]),p("div",{style:{position:"relative",height:32,background:"#fff",borderRadius:4},children:[p("div",{className:"constraint-input-root"+(r||d||l?" input-activated":"")+(H.length>0&&r||l?" menu-revealed":""),ref:n,children:[s(Ws,{inputProps:E(),placeholder:"\u5C5E\u6027\u540D",onFocus:()=>{i(!0)},onBlur:()=>{i(!1)}}),s(nn,{value:ae[f!=null?f:0],style:{fontWeight:600},onChange:v=>m(Number(v.target.value)),inputProps:{ref:o,onChange:v=>m(Number(v.target.value))},placeholder:"==",onFocus:()=>{c(!0)},onBlur:()=>{c(!1)}}),s(nn,{placeholder:"...",value:N,onChange:v=>S(v.target.value),style:{textAlign:"right"},inputProps:{ref:a},onFocus:()=>{g(!0)},onBlur:()=>{g(!1)}})]}),n.current&&H.length>0&&s(ne,{open:r,anchorEl:n.current,style:{width:n.current.getBoundingClientRect().width},className:"hint-root",children:s("ul",P(D({},L()),{style:{margin:0,padding:0},children:H.map((v,I)=>{const _=W({option:v,index:I});return h.exports.createElement("li",P(D({},_),{style:{fontFeatureSettings:'"liga" 1'},key:v.name,className:"constraint-intellisense-button",onClick:z=>{var he,pe;C(v),(he=o.current)==null||he.focus(),(pe=_.onClick)==null||pe.call(_,z)}}),s("span",{children:v.name}),s("code",{style:{color:"rgb(0, 204, 175)"},className:"shimmed",children:v.type}))})}))}),n.current&&x&&s(ne,{open:l,anchorEl:n.current,style:{width:(w=n.current)==null?void 0:w.getBoundingClientRect().width},className:"hint-root",children:s("ul",{style:{margin:0,padding:0},children:dt[x.type].map((v,I)=>p("li",{className:"constraint-intellisense-button",onPointerDown:_=>{var z;m(v),_.stopPropagation(),_.preventDefault(),(z=a.current)==null||z.focus()},children:[s("span",{style:{opacity:.25},className:"shimmed",children:x.name}),s("span",{style:{fontWeight:600},children:ae[v]}),p("span",{style:{opacity:.25},className:"shimmed",children:["(",on[v],")"]})]},v))})})]})}),ct=B(Ps)(t=>({fontFamily:"var(--mono-font)"}));B(ne)(t=>({width:320}));const qs=t=>{var w;const[e,n]=h.exports.useState(null),[o,a]=h.exports.useState(""),[r,i]=h.exports.useState(null),[l,c]=h.exports.useState(null),d=h.exports.useRef(null);h.exports.useRef(null);const g=h.exports.useRef(null),x=h.exports.useRef(null),[C,f]=h.exports.useState(!1),[m,N]=h.exports.useState(!1),[S,E]=h.exports.useState(!1),[L,W]=h.exports.useState(!1);h.exports.useEffect(()=>{e!=null&&r==null&&(i(b.Equal),setTimeout(()=>{var v;(v=g.current)==null||v.select()},0))},[e]),h.exports.useEffect(()=>{var v;r==null||e==null||(c(zs[e.type]),(v=x.current)==null||v.select())},[r]);const{getInputProps:H,getListboxProps:T,getOptionProps:A,groupedOptions:y}=Ke({id:"use-autocomplete-prop",options:t.class.properties,getOptionLabel:v=>v.name,value:e,onChange:(v,I)=>n(I),inputValue:o,onInputChange:(v,I)=>a(I),selectOnFocus:!0});return p(O,{children:[p("div",{ref:d,style:{display:"grid",gridTemplateColumns:"1fr 36px 1fr",columnGap:8,margin:"8px 16px 8px 16px",border:`1px solid ${C?"red":"var(--grey100)"}`,borderRadius:3,fontFamily:"var(--mono-family)"},children:[s(ct,{placeholder:"\u5C5E\u6027\u540D",inputProps:H(),onMouseUp:v=>v.target.select(),onFocus:()=>{N(!0)},onBlur:()=>{N(!1)}}),s(ct,{placeholder:"==",inputProps:{ref:g},value:e?ae[r!=null?r:0]:void 0,onFocus:()=>{var v;E(!0),(v=g.current)==null||v.focus()},onBlur:()=>{E(!1)}}),s(ct,{placeholder:"\u503C",value:l===null?"":String(l),onChange:v=>{switch(e==null?void 0:e.type){case"string":{c(v.target.value);break}case"number":{const I=Number(v.target.value);!isNaN(I)&&!Mn.exports.isUndefined(I)&&c(I)}case"boolean":{const I=Boolean(v.target.value);c(I)}}},inputProps:{ref:x},onFocus:()=>{var v;W(!0),(v=x.current)==null||v.select()},onBlur:()=>{W(!1)}})]}),p("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",columnGap:16,padding:16},children:[s(Ne,{onClick:v=>{n(null),i(null),c(null)},children:"\u6E05\u7A7A"}),s(Pe,{onClick:v=>{e!=null&&l!=null&&l!=""&&r!=null?(t.onConstraintCreate({operator:r,value:l,property:e}),n(null),i(null),c(null)):C||(f(!0),setTimeout(()=>{f(!1)}))},children:"\u6DFB\u52A0"})]}),d.current&&y.length>0&&s(ne,{open:m,anchorEl:d.current,style:{width:d.current.getBoundingClientRect().width},className:"hint-root",children:s("ul",P(D({},T()),{style:{margin:0,padding:0},children:y.map((v,I)=>{const _=A({option:v,index:I});return h.exports.createElement("li",P(D({},_),{style:{fontFeatureSettings:'"liga" 1',display:"flex",justifyContent:"space-between"},key:v.name,className:"constraint-intellisense-button",onClick:z=>{var he,pe,bt;n(v),(he=g.current)==null||he.focus(),(pe=g.current)==null||pe.select(),(bt=_.onClick)==null||bt.call(_,z)}}),s("span",{children:v.name}),s("code",{style:{color:"rgb(0, 204, 175)"},className:"shimmed",children:v.type}))})}))}),d.current&&e&&s(ne,{open:S,anchorEl:d.current,style:{width:(w=d.current)==null?void 0:w.getBoundingClientRect().width},className:"hint-root",children:s("ul",{style:{margin:0,padding:0},children:dt[e.type].map((v,I)=>p("li",{className:"constraint-intellisense-button",onPointerDown:_=>{var z;i(v),_.stopPropagation(),_.preventDefault(),(z=x.current)==null||z.focus()},children:[s("span",{style:{opacity:.25},className:"shimmed",children:e.name}),s("span",{style:{fontWeight:600},children:ae[v]}),p("span",{style:{opacity:.25},className:"shimmed",children:["(",on[v],")"]})]},v))})})]})};const ut=B(De)(t=>({height:32,width:"100%",border:"1px solid transparent",borderRadius:4,"&:hover":{border:"1px solid var(--grey100)"},"&:active":{border:"1px solid var(--grey100)"}})),Gs=B("ul")(t=>({width:"100%"})),ht=B("div")(t=>({width:"100%",height:32,color:"#fff",verticalAlign:"center","&:hover":{backgroundColor:"var(--primary)"},cursor:"default",">div>svg>circle":{stroke:"#fff"},">.edge-class-opt>div>div>svg>path":{stroke:"#fff"}}));B("div")(t=>({width:"100%",height:32,color:"#fff",verticalAlign:"center","&:hover":{backgroundColor:"var(--primary)"},cursor:"default"}));const Us=B("div")(t=>({width:"100%",height:"100%",display:"grid",alignItems:"center",fontSize:14,gridTemplateColumns:"24px 1fr 20px",padding:"0 4px",textAlign:"left",columnGap:4,">svg>path":{transition:"transform 0.2s"}}));B("div")(t=>({width:"100%",height:"100%",display:"grid",alignItems:"center",fontSize:14,padding:"0 4px",textAlign:"left",columnGap:4,">svg>path":{transition:"transform 0.2s"}}));te.forwardRef(function(e,n){const o=D({Root:ut,Listbox:Gs,Popper:ht},e.components);return s(Ln,P(D({},e),{ref:n,components:o}))});const sn=t=>p(Us,{className:t.className,children:[s("svg",{width:24,height:24,children:s("circle",{cx:12,cy:12,r:8,fill:t.coloredClass.colorSlot.primary})}),s("div",{className:"truncate",children:t.coloredClass.name}),t.droppable&&s(At,{}),t.selected&&s(Dt,{})]}),an=t=>p("div",{className:`edge-class-opt ${t.className}`,children:[p("div",{className:"edge-class-content",children:[s("svg",{width:16,height:24,children:s("circle",{cx:12,cy:12,r:4,fill:t.edgeClass.from.colorSlot.primary})}),s("div",{className:"truncate",children:t.edgeClass.from.name}),s("div",{className:"arrow-container",children:t.edgeClass.specificType?p(O,{children:[s("svg",{width:24,height:24,className:"arrow-svg",children:s("path",{d:"M4 12L20 12"})}),t.edgeClass.specificType,p("svg",{width:24,height:24,className:"arrow-svg",children:[s("path",{d:"M4 12L20 12"}),s("path",{d:"M16 9L20 12L16 15"})]})]}):p("svg",{width:72,height:24,className:"arrow-svg",children:[s("path",{d:"M4 12L68 12"}),s("path",{d:"M64 9L68 12L64 15"})]})}),s("svg",{width:16,height:24,children:s("circle",{cx:12,cy:12,r:4,fill:t.edgeClass.to.colorSlot.primary})}),s("div",{className:"truncate",children:t.edgeClass.to.name})]}),t.droppable&&s(At,{}),t.selected&&s(Dt,{})]});function Js(t){var a;const e=h.exports.useRef(null),[n,o]=h.exports.useState(!1);return p(O,{children:[s(je,{onClickAway:r=>{o(!1)},children:s(ut,{ref:e,onClick:r=>{o(!0)},style:{borderRadius:n?"4px 4px 0 0":void 0,borderColor:n?"var(--grey100)":void 0},children:t.defaultOption&&s(sn,{coloredClass:t.defaultOption,droppable:!0,className:n?"open-chevron":"hide-chevron"})})}),s(ee,{target:e.current,isBeakVisible:!1,hidden:!n,calloutWidth:(a=e.current)==null?void 0:a.getBoundingClientRect().width,styles:{calloutMain:{borderRadius:0}},children:s("div",{style:{background:"#212224",padding:"8px 1px",borderRadius:0,maxHeight:"90vh",overflow:"auto"},children:t.options.map(r=>{var i,l;return s(ht,{className:r.id===((i=t.defaultOption)==null?void 0:i.id)?"general-input-option-selected":"",children:s(sn,{coloredClass:r,selected:r.id===((l=t.defaultOption)==null?void 0:l.id)})},r.id)})})})]})}function Ks(t){var a;const e=h.exports.useRef(null),[n,o]=h.exports.useState(!1);return p(O,{children:[s(je,{onClickAway:r=>{o(!1)},children:s(ut,{ref:e,onClick:r=>{o(!0)},style:{borderRadius:n?"4px 4px 0 0":void 0,borderColor:n?"var(--grey100)":void 0},children:t.defaultOption&&s(an,{edgeClass:t.defaultOption,droppable:!0,className:n?"open-chevron":"hide-chevron"})})}),s(ee,{target:e.current,isBeakVisible:!1,hidden:!n,calloutWidth:(a=e.current)==null?void 0:a.getBoundingClientRect().width,styles:{calloutMain:{borderRadius:0}},children:s("div",{style:{background:"#212224",padding:"8px 1px",borderRadius:0,maxHeight:"90vh",overflow:"auto"},children:t.options.map(r=>{var i,l;return s(ht,{className:r.id===((i=t.defaultOption)==null?void 0:i.id)?"general-input-option-selected":"",children:s(an,{edgeClass:r,selected:r.id===((l=t.defaultOption)==null?void 0:l.id)})},r.id)})})})]})}const $e=B(Z)(t=>({fontSize:14,fontFamily:"var(--mono-font)",height:32,width:"100%",border:"1px solid transparent",borderRadius:4,"&>input":{padding:0,width:"100%",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},"&:hover":{border:"1px solid var(--grey100)"},"&:active":{border:"1px solid var(--grey100)"},"&:focus":{border:"1px solid var(--grey100)"},padding:"0 8px"})),ce=B("div")(t=>({fontSize:14,color:"var(--grey200)",userSelect:"none"})),Vs=t=>{var o;const{focusElement:e}=t,n=F(_e);return q(),e?e.type===M.Node?p(O,{children:[p("div",{className:"panel-decl hide-padding-bottom",children:[s(ce,{children:"\u6982\u5FF5"}),s("div",{children:s(Js,{defaultOption:e.class,onSelectOption:a=>{},options:(o=n==null?void 0:n.classes)!=null?o:[]})}),s(ce,{children:"\u540D\u79F0"}),s($e,{onFocus:a=>a.target.select(),onMouseUp:a=>{a.preventDefault()},inputProps:{onFocus:a=>a.target.select(),onMouseUp:a=>{a.preventDefault()}},placeholder:e.id,value:e.alias,onChange:a=>{const r=a.target.value||"";t.onChangeAlias(r)}})]}),p("div",{className:"panel-decl col2 hide-padding-top",children:[s(ce,{className:"offsetx2",children:"X"}),s($e,{placeholder:"-",defaultValue:e.position.x,onFocus:a=>a.target.select(),onMouseUp:a=>{a.preventDefault()},inputProps:{onFocus:a=>a.target.select(),onMouseUp:a=>{a.preventDefault()}}}),s(ce,{className:"offsetx2",children:"Y"}),s($e,{placeholder:"-",defaultValue:e.position.y,onFocus:a=>a.target.select(),onMouseUp:a=>{a.preventDefault()},inputProps:{onFocus:a=>a.target.select(),onMouseUp:a=>{a.preventDefault()}}})]})]}):e.type===M.Edge?p("div",{className:"panel-decl",children:[s(ce,{children:"\u6982\u5FF5"}),s("div",{children:s(Ks,{defaultOption:e.class,options:[e.class],onSelectOption:a=>{}})}),s(ce,{children:"\u540D\u79F0"}),s($e,{placeholder:e.id,onFocus:a=>a.target.select(),onMouseUp:a=>{a.preventDefault()},inputProps:{onFocus:a=>a.target.select(),onMouseUp:a=>{a.preventDefault()}}})]}):s("div",{}):s("div",{})},Xs=t=>t.length>3?t.slice(0,2)+"..."+t[t.length-1]:X.spacing(t),Qs=t=>{var c,d;const e=q(),n=F(Xt),o=F(Ce.selectAll),a=F(oe.selectAll),[r,i]=h.exports.useState(!1),l=h.exports.useRef(null);return n?p(O,{children:[p("div",{children:[s(J,{text:"\u5B9A\u4E49"}),s(Vs,{focusElement:n,onChangeAlias:g=>{var x;e(vo({id:n.id,changes:{alias:g}})),(x=t.engineRef.current)==null||x.modifyAlias(g,n.id)}},n.id),s("div",{style:{height:32}}),((d=(c=n.class)==null?void 0:c.properties)==null?void 0:d.length)?p(O,{children:[s(J,{text:"\u7EA6\u675F\u5B9A\u4E49",topBordered:!0}),s(qs,{node:n,class:n.class,onConstraintCreate:g=>{e(uo(D({targetType:n.type,targetId:n.id,position:{x:0,y:0},id:j()},g)))}},n.id),s("div",{style:{height:32}}),s(J,{text:"\u5DF2\u6DFB\u52A0\u7684\u5C5E\u6027\u7EA6\u675F",topBordered:!0}),s("div",{className:"panel-constraints",style:{maxHeight:"calc(100vh - 480px)"},children:o.map(g=>{const x=a.find(C=>C.id===g.targetId);return p("div",{draggable:!0,style:{display:"grid",gridTemplateColumns:"16px 80px 1fr 32px 32px",padding:"4px 2px",borderRadius:4,alignItems:"center"},className:"damn",children:[s(Hn,{style:{transform:"translate(-2px)"}}),p("div",{style:{display:"flex",height:"100%",alignItems:"center"},children:[s("svg",{width:16,height:16,children:s("circle",{cx:8,cy:8,r:8,fill:x==null?void 0:x.class.colorSlot.primary})}),s("div",{className:"truncate",style:{width:56,margin:"0 4px",overflow:"hidden",textOverflow:"hidden",fontSize:13},children:(x==null?void 0:x.alias)?Xs(x==null?void 0:x.alias):x==null?void 0:x.id})]}),s(js,{node:n,class:n.class,constraint:g,onConstraintChange:C=>{e(lo({id:g.id,changes:C}))}}),s(Q,{disableRipple:!0,style:{marginLeft:4},onClick:C=>{e(co(g.id))},children:s(zn,{})}),s(Q,{disableRipple:!0,onClick:C=>{e(ho(g))},children:s(Ue,{})})]},g.id)})})]}):p(O,{children:[s(J,{text:"\u7EA6\u675F\u5B9A\u4E49",topBordered:!0}),s("div",{className:"panel-desc",children:n.type===M.Node?`\u65E0\u6CD5\u5BF9\u6982\u5FF5${n.class.name}\u6DFB\u52A0\u7EA6\u675F\uFF0C\u56E0\u4E3A\u8FD9\u4E2A\u7C7B\u578B\u4E0D\u5305\u542B\u5C5E\u6027\u3002`:`\u65E0\u6CD5\u5BF9${n.class.name}\u7684\u8FB9\u6DFB\u52A0\u5C5E\u6027\u7EA6\u675F\uFF0C\u56E0\u4E3A\u8FD9\u6761\u8FB9\u4E0D\u5305\u542B\u5C5E\u6027\u3002`})]})]}),r&&s(ee,{target:l.current,onDismiss:g=>i(!1),isBeakVisible:!1,directionalHint:re.leftTopEdge,styles:{calloutMain:{borderRadius:0,animation:"none"}},children:s(Hs,{node:n,class:n.class,onDismiss:()=>i(!1),onConstraintChange:g=>{}})})]}):p("div",{children:[s(J,{text:"\u5B9A\u4E49\u548C\u5C5E\u6027\u7EA6\u675F"}),s("div",{className:"panel-desc",children:"\u9009\u4E2D\u70B9\u6216\u8FB9\u4EE5\u67E5\u770B\u5176\u5B9A\u4E49\u548C\u7EA6\u675F\u3002"})]})},Ys=t=>{const e=F(rt),n=q(),o=h.exports.useRef(null),[a,r]=h.exports.useState(!1);h.exports.useEffect(()=>{a?document.body.className="cursor-ew":document.body.className=""},[a]);const i=h.exports.useMemo(()=>s(Qs,{engineRef:t.engineRef}),[t.engineRef]);return p("div",{className:"property-panel-root panel",ref:o,style:{width:e},children:[i,s(Je,{axis:"x",onDrag:(l,c)=>{n(Bo(e-c.x))},onStart:()=>{r(!0)},onStop:(l,c)=>{r(!1)},position:{x:-2,y:0},children:s("div",{className:"property-panel-handler",style:{backgroundColor:a?"var(--primary)":void 0}})})]})};class rn{constructor(e,n,o,a){u(this,"elementType",M.Node);u(this,"connections",[]);u(this,"_alias");u(this,"ontologyClass");u(this,"uuid");u(this,"logicPosition");u(this,"renderElements");u(this,"_isFocused",!1);u(this,"focus",()=>{var e;(e=this.renderElements)==null||e.root.attr("focused",!0),this._isFocused=!0});u(this,"blur",()=>{var e;(e=this.renderElements)==null||e.root.attr("focused",!1),this._isFocused=!1});u(this,"_isConstrained",!1);u(this,"_isDisabled",!1);this.ontologyClass=e,this.logicPosition=n,this.uuid=o,this._alias=a}get alias(){return this._alias}set alias(e){var n,o,a,r,i,l,c,d;if(this._alias=e,e!==void 0){(n=this.renderElements)==null||n.root.attr("aliased",!0);const g=this.getRenderedAlias(e);if(this.renderElements)if(this.renderElements.aliasText.text(g),g.length>0){const x=(a=(o=this.renderElements.aliasText.node())==null?void 0:o.getBoundingClientRect().width)!=null?a:0,C=(i=(r=this.renderElements.typeText.node())==null?void 0:r.getBoundingClientRect().width)!=null?i:0;this.renderElements.typeText.attr("x",-(C+x+12)/2),this.renderElements.aliasText.attr("x",-(C+x+12)/2+C+8),this.renderElements.aliasContainer.attr("width",g.length>0?x+12:0).attr("x",-(C+x+12)/2+C+2)}else{const x=(c=(l=this.renderElements.typeText.node())==null?void 0:l.getBoundingClientRect().width)!=null?c:0;this.renderElements.typeText.attr("x",-x/2),this.renderElements.aliasContainer.attr("width",0)}}else(d=this.renderElements)==null||d.root.attr("aliased",!1)}static deserializeFromJSON(e){}getRenderedAlias(e){return e.startsWith(this.ontologyClass.name)?e.replace(this.ontologyClass.name,""):e}attachTo(e){var g,x,C,f,m,N;const n=e.append("g").attr("class","p-n").attr("node-uuid",this.uuid).attr("transform",`translate(${this.logicPosition.x}, ${this.logicPosition.y})`),o=n.append("circle").attr("class","selection"),a=n.append("circle").attr("class","node").attr("r",12).attr("fill",this.ontologyClass.colorSlot.primary),r=n.append("circle").attr("class","constrain-ring").attr("r",15).attr("stroke",this.ontologyClass.colorSlot.constrained),i=n.append("rect").attr("class","alias-rect").attr("y",16).attr("height",16).attr("rx",8).attr("ry",8).attr("fill",this.ontologyClass.colorSlot.constrained),l=this.alias?this.getRenderedAlias(this.alias):"",c=n.append("text").attr("class","alias").attr("y",24).attr("fill",this.ontologyClass.colorSlot.foreground).text(l),d=n.append("text").attr("class","type").attr("y",24).attr("fill",this.ontologyClass.colorSlot.darkened).text(this.ontologyClass.name);if(l.length>0){const S=(x=(g=c.node())==null?void 0:g.getBoundingClientRect().width)!=null?x:0,E=(f=(C=d.node())==null?void 0:C.getBoundingClientRect().width)!=null?f:0;d.attr("x",-(E+S+12)/2),c.attr("x",-(E+S+12)/2+E+8),i.attr("width",l.length>0?S+12:0).attr("x",-(E+S+12)/2+E+2)}else{const S=(N=(m=d.node())==null?void 0:m.getBoundingClientRect().width)!=null?N:0;d.attr("x",-S/2)}n.attr("aliased",Boolean(this._alias)),this.renderElements={root:n,ring:r,circle:a,aliasText:c,typeText:d,selection:o,aliasContainer:i}}detach(){var e;(e=this.renderElements)==null||e.root.remove()}getBoundingBox(){var e,n,o;return(o=(n=(e=this.renderElements)==null?void 0:e.root)==null?void 0:n.node())==null?void 0:o.getBoundingClientRect()}on(e,n){var o;return(o=this.renderElements)==null?void 0:o.root.on(e,n)}get isFocused(){return this._isFocused}set isConstrained(e){var n;e!=this.isConstrained&&(this._isConstrained=e,(n=this.renderElements)==null||n.root.attr("constrained",e))}get isConstrained(){return this._isConstrained}asObject(){return{id:this.uuid,constraints:[],position:this.logicPosition,class:this.ontologyClass,alias:this._alias}}setDisabled(e){var n,o;this._isDisabled!==e&&(this._isDisabled=e,e?(n=this.renderElements)==null||n.root.attr("disabled",!0):(o=this.renderElements)==null||o.root.attr("disabled",!1))}getDisabled(){return this._isDisabled}}xe("g");const Zs="M-9,6L0,0L-9,-6";class ue{constructor(e,n,o,a,r){u(this,"from");u(this,"to");u(this,"avoidHead");u(this,"avoidRadius");u(this,"avoidRadiusSquared");u(this,"additionalClass");u(this,"direction");u(this,"renderElement");u(this,"getAttributes",()=>{const e=this.to.x-this.from.x,n=this.to.y-this.from.y,o=n*n+e*e,a=Math.atan2(n,e)/Math.PI*180,r=Math.sqrt(o),i=this.avoidRadius/r*e,l=this.avoidRadius/r*n,c=`translate(${this.avoidHead?this.to.x-i:this.to.x},${this.avoidHead?this.to.y-l:this.to.y}) rotate(${a})`;return o<=this.avoidRadiusSquared?{bodyPath:"M0,0",headTransform:c}:{bodyPath:`M${i},${l}L${this.avoidHead?e-i:e},${this.avoidHead?n-l:n}`,headTransform:c}});this.from=e,this.to=n,this.avoidRadius=o!=null?o:0,this.avoidRadiusSquared=this.avoidRadius*this.avoidRadius,this.avoidHead=a!=null?a:!1,this.additionalClass=r}attachTo(e){const n=e.append("g").attr("class","a-g");this.additionalClass&&n.classed(this.additionalClass,!0);const{bodyPath:o,headTransform:a}=this.getAttributes(),r=n.append("path").attr("class","a-body").attr("d",o).attr("transform",`translate(${this.from.x}, ${this.from.y})`),i=n.append("path").attr("class","a-head").attr("d",Zs).attr("transform",a);return this.renderElement={root:n,body:r,head:i},n}modifyEndpoint(e){var a,r;const{bodyPath:n,headTransform:o}=this.getAttributes();this.to=e,(a=this.renderElement)==null||a.body.attr("d",n),(r=this.renderElement)==null||r.head.attr("transform",o)}applyAttributes(e){var n,o;(n=this.renderElement)==null||n.body.attr("d",e.bodyPath),(o=this.renderElement)==null||o.head.attr("transform",e.headTransform)}remove(){var e;(e=this.renderElement)==null||e.root.remove()}attr(e,n){var o;return(o=this.renderElement)==null?void 0:o.root.attr(e,n)}}class pt{constructor(e,n,o,a,r,i){u(this,"elementType",M.Edge);u(this,"from");u(this,"to");u(this,"name");u(this,"properties");u(this,"isDirected");u(this,"uuid");u(this,"renderElements");u(this,"_isFocused",!1);u(this,"focus",()=>{var e;(e=this.renderElements)==null||e.root.attr("focused",!0),this._isFocused=!0});u(this,"blur",()=>{var e;(e=this.renderElements)==null||e.root.attr("focused",!1),this._isFocused=!1});u(this,"_isDisabled",!1);u(this,"_isConstrained",!1);this.from=e,this.to=n,this.isDirected=o,this.uuid=a,this.properties=r,this.name=i}get logicVector(){return{x:this.to.logicPosition.x-this.from.logicPosition.x,y:this.to.logicPosition.y-this.from.logicPosition.y}}attachTo(e){var r;const n=e.append("g").attr("class","p-e").attr("edge-uuid",this.uuid),o=new ue(this.from.logicPosition,this.to.logicPosition,18,!0),a=new ue(this.from.logicPosition,this.to.logicPosition,18,!0,"hover");a.attachTo(n),o.attachTo(n),(r=o.renderElement)==null||r.root.attr("pointer-events","none"),this.renderElements={root:n,arrow:o,hoverArrow:a}}on(e,n){var o;return(o=this.renderElements)==null?void 0:o.root.on(e,n)}getBoundingBox(){return{x:(this.from.logicPosition.x+this.to.logicPosition.x)/2-12,y:(this.from.logicPosition.y+this.to.logicPosition.y)/2-12,width:24,height:24}}get isFocused(){return this._isFocused}setDisabled(e){var n;this._isDisabled!==e&&(this._isDisabled=e,(n=this.renderElements)==null||n.root.attr("disabled",e))}get isDisabled(){return this._isDisabled}set isConstrained(e){var n;this._isConstrained!==e&&(this._isConstrained=e,(n=this.renderElements)==null||n.root.attr("constrained",e))}get isConstrained(){return this._isConstrained}asObject(){var e,n;return{id:this.uuid,from:this.from.uuid,to:this.to.uuid,class:{from:this.from.ontologyClass,to:this.to.ontologyClass,properties:(e=this.properties)!=null?e:[],name:(n=this.name)!=null?n:`${this.from.ontologyClass.name}-->${this.to.ontologyClass.name}`,id:`${this.from.ontologyClass.id}-->${this.to.ontologyClass.id}`},direction:this.isDirected?Se.Specified:Se.Unspecified,constraints:[]}}}const ea=(t,e)=>(t.x-e.x)**2+(t.y-e.y)**2,ln="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").concat("\u03B1\u03B2\u03B3\u03B4\u03B5\u03B6\u03B7\u03B8\u03B9\u03BA\u03BB\u03BC\u03BD\u03BE\u03BF\u03C0\u03C1\u03C3\u03C4\u03C5\u03C6\u03C7\u03C8\u03C9".split(""));var dn;(function(t){t[t.Error=0]="Error",t[t.Warning=1]="Warning",t[t.Success=2]="Success"})(dn||(dn={}));class ta{constructor(e,n){u(this,"model");u(this,"_editMode",k.Default);u(this,"editPayload",null);u(this,"renderContainer");u(this,"svgLayer");u(this,"nodeLayer");u(this,"edgeLayer");u(this,"_focusedElement",null);u(this,"_focusedElementChangedCallback");u(this,"_onNodeContextMenu");u(this,"_onNodeCreatedCallback");u(this,"_onEdgeCreatedCallback");u(this,"_onConstraintCreatedCallback");u(this,"_onRaiseMessageCallback");u(this,"_assignNewName",e=>e.name+ln[0]);u(this,"setAssignNewName",e=>{this._assignNewName=e});u(this,"setOnNodeCreatedCallback",e=>{this._onNodeCreatedCallback=e});u(this,"setOnEdgeCreatedCallback",e=>{this._onEdgeCreatedCallback=e});u(this,"setOnConstraintCreatedCallback",e=>{this._onConstraintCreatedCallback=e});u(this,"setRaiseMessageCallback",e=>{this._onRaiseMessageCallback=e});u(this,"setOnNodeContextMenu",e=>{this._onNodeContextMenu=e});u(this,"nodeDict",{});u(this,"edgeDict",{});u(this,"zoomTransform");u(this,"mouseIndicatorLayer");u(this,"eventProtecter");u(this,"nodeIndicator");u(this,"connectionIndicator");u(this,"onPointerMove",e=>{var n,o,a,r,i,l;switch(this.editMode){case k.Default:break;case k.CreatingNode:{if(!K(this.editPayload))(n=this.nodeIndicator)==null||n.remove(),this.nodeIndicator=void 0;else{const c=(o=this.model.colorSlots[this.editPayload].colorSlot)!=null?o:{primary:"#b0b1b4"},d=(r=(a=this.zoomTransform)==null?void 0:a.invert([e.offsetX,e.offsetY]))!=null?r:[e.offsetX,e.offsetY];(i=this.mouseIndicatorLayer)==null||i.attr("transform",`translate(${d[0]}, ${d[1]})`),this.nodeIndicator||(this.nodeIndicator=(l=this.mouseIndicatorLayer)==null?void 0:l.append("circle").attr("r",12).attr("cx",0).attr("cy",0).attr("opacity",.5)),this.nodeIndicator&&this.nodeIndicator.attr("fill",c.primary)}break}case k.CreatingEdgeFrom:break;case k.CreatingEdgeTo:break}});u(this,"onPointerLeave",e=>{var n,o;(n=this.nodeIndicator)==null||n.remove(),this.nodeIndicator=void 0,(o=this.connectionIndicator)==null||o.remove(),this.connectionIndicator=void 0});u(this,"onClick",e=>{var n,o,a,r,i;switch(this.editMode){case k.Default:{this.focusedElement=null;break}case k.CreatingNode:{if(K(this.editPayload)){const l=this.model.colorSlots[this.editPayload];if(l){const c=(o=(n=this.zoomTransform)==null?void 0:n.invert([e.offsetX,e.offsetY]))!=null?o:[e.offsetX,e.offsetY],d=new rn(l,{x:c[0],y:c[1]},j(),this._assignNewName(l));(a=this._onNodeCreatedCallback)==null||a.call(this,d.asObject()),this.nodeDict[d.uuid]=d,d.attachTo(this.nodeLayer),setTimeout(()=>{this.focusedElement=d},0),d.on("click",g=>{this.onNodeClick(d,g)}),d.on("pointerenter",g=>{this.onNodePointerEnter(d,g)}),d.on("pointerleave",g=>{this.onNodePointerLeave(d,g)}),d.on("contextmenu",g=>{var x;(x=this._onNodeContextMenu)==null||x.call(this,d,g)}),(r=d.renderElements)==null||r.root.call(It().on("start",()=>{this.dragStartNode=d}).on("drag",this._onNodeDrag).on("end",this._onNodeDragEnd)),this.editPayload=null,(i=this.nodeIndicator)==null||i.remove(),this.nodeIndicator=void 0}}else this.focusedElement=null;break}case k.CreatingEdgeFrom:{this.focusedElement=null;break}case k.CreatingEdgeTo:{Object.values(this.nodeDict).forEach(l=>{l.setDisabled(!1)}),Object.values(this.edgeDict).forEach(l=>l.setDisabled(!1)),this.focusedElement=null,this.editMode=k.CreatingEdgeFrom;break}}});u(this,"createEdgeFrom",null);u(this,"onNodeClick",(e,n)=>{var o,a,r,i,l;if(this.editMode===k.CreatingEdgeFrom){this.createEdgeFrom=e,this.focusedElement=e,this.editMode=k.CreatingEdgeTo;const c=e.ontologyClass.id;Object.values(this.nodeDict).forEach(d=>{this.model.connectable[c].to.includes(d.ontologyClass.id)||e.uuid===d.uuid||Object.values(this.edgeDict).findIndex(g=>g.from.uuid===e.uuid&&g.to.uuid===d.uuid||g.to.uuid===e.uuid&&g.from.uuid===d.uuid)!==-1?d.setDisabled(!1):d.setDisabled(!0)}),Object.values(this.edgeDict).forEach(d=>d.setDisabled(!0))}else if(this.editMode===k.CreatingEdgeTo){if(K(this.createEdgeFrom))if(e.getDisabled())(o=this._onRaiseMessageCallback)==null||o.call(this,`\u65E0\u6CD5\u6DFB\u52A0\u4ECE&thinsp;<b>${this.createEdgeFrom.ontologyClass.name}</b>&thinsp;\u5230&thinsp;<b>${e.ontologyClass.name}</b>&thinsp;\u7684\u8FB9\u7EA6\u675F`,0,!0);else if(e.uuid===((a=this.createEdgeFrom)==null?void 0:a.uuid))(r=this._onRaiseMessageCallback)==null||r.call(this,"\u4E0D\u652F\u6301\u81EA\u73AF",0,!0);else{const c=this.model.getRelationNames((i=this.createEdgeFrom)==null?void 0:i.ontologyClass,e.ontologyClass)[0].name,d=new pt(this.createEdgeFrom,e,!0,j(),[],c);(l=this._onEdgeCreatedCallback)==null||l.call(this,d.asObject()),this.edgeDict[d.uuid]=d,d.attachTo(this.edgeLayer),d.on("click",g=>{this.onEdgeClick(d,g)}),setTimeout(()=>{this.focusedElement=d},0)}Object.values(this.nodeDict).forEach(c=>c.setDisabled(!1)),Object.values(this.edgeDict).forEach(c=>c.setDisabled(!1)),this.focusedElement=null,this.createEdgeFrom=null,this.mouseHoveringAtNode=null,this.editMode=k.CreatingEdgeFrom}else this.focusedElement=e;n.stopPropagation()});u(this,"mouseHoveringAtNode",null);u(this,"onNodePointerEnter",(e,n)=>{this.editMode===k.CreatingEdgeTo&&this.createEdgeFrom&&(this.mouseHoveringAtNode=e)});u(this,"onNodePointerLeave",(e,n)=>{this.editMode===k.CreatingEdgeTo&&this.createEdgeFrom&&(this.mouseHoveringAtNode=null)});u(this,"onEdgeClick",(e,n)=>{this.editMode>=2&&(this.createEdgeFrom=null,this.editMode=k.CreatingEdgeFrom),this.focusedElement=e,n.stopPropagation()});u(this,"dragStartNode");u(this,"isDragNailed",!1);u(this,"_onNodeDrag",e=>{if(this.dragStartNode&&ea(this.dragStartNode.logicPosition,e)>200){if(!this.isDragNailed&&this.dragStartNode){this.setEditModeWithPayload(k.CreatingEdgeTo,this.dragStartNode.uuid),this.createEdgeFrom=this.dragStartNode;const n=this.dragStartNode.ontologyClass.id;Object.values(this.nodeDict).forEach(o=>{var a;(this.model.connectable[n].to.includes(o.ontologyClass.id)||((a=this.dragStartNode)==null?void 0:a.uuid)===o.uuid)&&Object.values(this.edgeDict).findIndex(r=>r.from.uuid===this.dragStartNode.uuid&&r.to.uuid===o.uuid||r.to.uuid===this.dragStartNode.uuid&&r.from.uuid===o.uuid)===-1?o.setDisabled(!1):o.setDisabled(!0)}),Object.values(this.edgeDict).forEach(o=>o.setDisabled(!0)),this.isDragNailed=!0,this.eventProtecter.className="event-protect-active"}if(this.mouseHoveringAtNode&&!this.mouseHoveringAtNode.getDisabled()){const n=new ue(this.createEdgeFrom.logicPosition,this.mouseHoveringAtNode.logicPosition,18,!0);this.connectionIndicator?(this.connectionIndicator.applyAttributes(n.getAttributes()),this.connectionIndicator.attr("stroke-dasharray","none")):(this.connectionIndicator=n,this.connectionIndicator.attachTo(this.mouseIndicatorLayer).attr("opacity",.4).attr("stroke-dasharray","none"))}else this.connectionIndicator?(this.connectionIndicator.modifyEndpoint(e),this.connectionIndicator.attr("stroke-dasharray","8, 8")):(this.connectionIndicator=new ue(this.dragStartNode.logicPosition,e,18,!1),this.connectionIndicator.attachTo(this.mouseIndicatorLayer).attr("opacity",.4).attr("stroke-dasharray","8, 8"))}});u(this,"_onNodeDragEnd",e=>{var n,o,a,r,i;if(this.dragStartNode&&this.isDragNailed){const l=this.mouseHoveringAtNode;if(K(this.createEdgeFrom)&&K(l))if(l.getDisabled())(n=this._onRaiseMessageCallback)==null||n.call(this,`\u65E0\u6CD5\u6DFB\u52A0\u4ECE&thinsp;<b>${this.createEdgeFrom.ontologyClass.name}</b>&thinsp;\u5230&thinsp;<b>${l.ontologyClass.name}</b>&thinsp;\u7684\u8FB9\u7EA6\u675F`,0,!0);else if(l.uuid===((o=this.createEdgeFrom)==null?void 0:o.uuid))(a=this._onRaiseMessageCallback)==null||a.call(this,"\u4E0D\u652F\u6301\u81EA\u73AF",0,!0);else{const c=this.model.getRelationNames((r=this.createEdgeFrom)==null?void 0:r.ontologyClass,l.ontologyClass)[0].name;console.error(c);const d=new pt(this.createEdgeFrom,l,!0,j(),[],c);(i=this._onEdgeCreatedCallback)==null||i.call(this,d.asObject()),this.edgeDict[d.uuid]=d,d.attachTo(this.edgeLayer),d.on("click",g=>{this.onEdgeClick(d,g)}),setTimeout(()=>{this.focusedElement=d},0)}Object.values(this.nodeDict).forEach(c=>c.setDisabled(!1)),Object.values(this.edgeDict).forEach(c=>c.setDisabled(!1)),this.focusedElement=null,this.createEdgeFrom=null,this.mouseHoveringAtNode=null,this.dragStartNode=void 0,this.isDragNailed=!1,this.eventProtecter.className="event-protect-inactive",this.editMode=k.Default}});u(this,"restoreFromFile",e=>{Object.values(e.nodes.entities).forEach(n=>{var a,r;const o=new rn(n.class,n.position,n.id,n.alias);(a=this._onNodeCreatedCallback)==null||a.call(this,o.asObject()),this.nodeDict[o.uuid]=o,o.attachTo(this.nodeLayer),o.on("click",i=>{this.onNodeClick(o,i)}),o.on("pointerenter",i=>{this.onNodePointerEnter(o,i)}),o.on("pointerleave",i=>{this.onNodePointerLeave(o,i)}),o.on("contextmenu",i=>{var l;(l=this._onNodeContextMenu)==null||l.call(this,o,i)}),(r=o.renderElements)==null||r.root.call(It().on("start",()=>{this.dragStartNode=o}).on("drag",this._onNodeDrag).on("end",this._onNodeDragEnd))}),Object.values(e.edges.entities).forEach(n=>{var i;if(!n)return;const o=this.nodeDict[n.from],a=this.nodeDict[n.to],r=new pt(o,a,!0,n.id,[],n.class.name);(i=this._onEdgeCreatedCallback)==null||i.call(this,r.asObject()),this.edgeDict[r.uuid]=r,r.attachTo(this.edgeLayer),r.on("click",l=>{this.onEdgeClick(r,l)})}),Object.values(e.constraints.entities).forEach(n=>{this.notifyElementConstrained(P(D({},e.nodes.entities[n.targetId]),{type:M.Node}))})});this.model=e,this.renderContainer=n,this.svgLayer=xe(n).append("svg").attr("class","engine-svg"),this.svgLayer.on("contextmenu",a=>{a.preventDefault()}),this.edgeLayer=this.svgLayer.append("g").attr("class","engine-core"),this.nodeLayer=this.svgLayer.append("g").attr("class","engine-core");const o=this.svgLayer.append("g");this.mouseIndicatorLayer=o.append("g").attr("class","engine-mouse-indicator"),this.eventProtecter=xe(this.renderContainer).append("div").node(),this.svgLayer.call(Wn().on("zoom",a=>{requestAnimationFrame(()=>{const r=a.transform.toString();this.zoomTransform=a.transform,this.nodeLayer.attr("transform",r),this.edgeLayer.attr("transform",r),o.attr("transform",r)})})),this.renderContainer.addEventListener("pointermove",this.onPointerMove),this.renderContainer.addEventListener("pointerleave",this.onPointerLeave),this.renderContainer.addEventListener("pointerenter",this.onPointerMove),this.renderContainer.addEventListener("click",this.onClick)}get editMode(){return this._editMode}set editMode(e){var n,o;this._editMode!==e&&(this._editMode=e,(n=this.mouseIndicatorLayer)==null||n.attr("transform","translate(0,0)"),(o=this.mouseIndicatorLayer)==null||o.selectChildren("*").remove(),this.nodeIndicator=void 0,this.connectionIndicator=void 0,Object.values(this.nodeDict).forEach(a=>a.setDisabled(!1)),Object.values(this.edgeDict).forEach(a=>a.setDisabled(!1)))}setFocusedElementChangedCallback(e){this._focusedElementChangedCallback=e}get focusedElement(){return this._focusedElement}set focusedElement(e){var n,o;this._focusedElement!==e&&((n=this._focusedElementChangedCallback)==null||n.call(this,e,this._focusedElement),(o=this._focusedElement)==null||o.blur(),e==null||e.focus(),this._focusedElement=e)}notifyElementConstrained(e,n=!0){e.type===M.Node?this.nodeDict[e.id].isConstrained=n:this.edgeDict[e.id].isConstrained=n}modifyAlias(e,n){this.nodeDict[n].alias=e}detach(){this.renderContainer.innerHTML=""}setEditModeWithPayload(e,n){this.editPayload=n,this.editMode=e}}class cn{constructor(e){u(this,"_parent");u(this,"_sets");u(this,"_idAccessorFn");this._parent={},this._sets=0,this._idAccessorFn=e}get trees(){return 1}_findSet(e){const n=this._idAccessorFn(e);return this._parent[n]!==e&&(this._parent[n]=this._findSet(this._parent[n])),this._parent[n]}_id(e){return e}get forestElements(){return Object.keys(this._parent).length}get forestSets(){return this._sets}areConnected(e,n){return!this.includes(e)||!this.includes(n)?!1:this._findSet(e)===this._findSet(n)}clear(){return this._parent={},this._sets=0,this}get parents(){return this._parent}findSet(e){if(this.includes(e))return this._findSet(e)}getId(e){if(!!this.includes(e))return this._idAccessorFn(e)}includes(e){return Object.prototype.hasOwnProperty.call(this._parent,this._idAccessorFn(e))}isEmpty(){return this.forestElements===0}isRepresentative(e){return this.includes(e)?this._parent[this._idAccessorFn(e)]===e:!1}makeSet(e){if(!this.includes(e)){const n=this._idAccessorFn(e);this._parent[n]=e,this._sets+=1}return this}makeSetByArray(e){return e.forEach(n=>{if(!this.includes(n)){const o=this._idAccessorFn(n);this._parent[o]=n,this._sets+=1}}),this}setParentTo(e,n){const o=this._idAccessorFn(e);this._parent[o]=n,Object.keys(this._parent).forEach(a=>{const r=this._parent[a],i=this._idAccessorFn(r);this._idAccessorFn(this._parent[i])==o&&this.setParentTo(this._parent[a],n)})}union(e,n){if(this.includes(e)&&this.includes(n)){const o=this._findSet(e),a=this._findSet(n);o!==a&&(this.setParentTo(n,e),this._sets-=1)}return this}}var un;(function(t){t[t.Concept=0]="Concept",t[t.Property=1]="Property"})(un||(un={}));var hn;(function(t){t[t.HasProperty=0]="HasProperty",t[t.HasSubConcept=1]="HasSubConcept",t[t.HasRelationConcept=2]="HasRelationConcept"})(hn||(hn={}));var gt;(function(t){t.getEdgeClassIdentifier=n=>`${n.from.id}->${n.to.id}`,t.getEdgeClassName=n=>`${n.from.name}->${n.to.name}`;class e{constructor(o,a,r){u(this,"name");u(this,"classes");u(this,"relations");u(this,"connectable");u(this,"colorSlots");u(this,"$classIdSelector",o=>o.id);this.name=o,this.classes=a,this.relations=r,this.connectable=Object.fromEntries(a.map(i=>[i.id,{from:[],to:[]}])),r.forEach(i=>{var l,c;(l=this.connectable[i.from])==null||l.to.push(i.to),(c=this.connectable[i.to])==null||c.from.push(i.from)}),this.connectable=$.mapValues(this.connectable,i=>({from:$.uniq(i==null?void 0:i.from),to:$.uniq(i==null?void 0:i.to)})),this.colorSlots=Object.fromEntries(a.map((i,l)=>[i.id,D({colorSlot:new Ot(Ye[l]).asObject()},i)]))}get classesByTreeView(){const o=new cn(this.$classIdSelector);return o.makeSetByArray(this.classes),this.classes.forEach(a=>{if(a.parent!==void 0&&a.parent!==null){const r=this.colorSlots[String(a.parent)];r&&o.union(r,a)}}),o.parents}getRelationNames(o,a){return this.relations.filter(r=>r.from===o.id&&r.to===a.id)}}t.Root=e,t.deserializeFromObject=n=>n?new e(n.name,n.classes,n.relations):null,t.serializeToObject=n=>({name:n.name,classes:Object.values(n.colorSlots),relations:n.relations})})(gt||(gt={}));const na=(t,e,n,o)=>{const a=h.exports.useMemo(()=>gt.deserializeFromObject(t),[t]),r=h.exports.useRef(null),i=h.exports.useRef(),l=q(),c=F(at),d=F(Qt),g=F(oe.selectAll);h.exports.useEffect(()=>{if(r.current&&a){const f=new ta(a,r.current);return f.setFocusedElementChangedCallback(m=>{l(Ut(m?{type:m.elementType,payload:m.asObject()}:void 0))}),f.setOnNodeCreatedCallback(m=>{l(xo(m)),l(Jt(void 0))}),f.setOnEdgeCreatedCallback(m=>{l(fo(m)),l(Jt(void 0))}),f.setRaiseMessageCallback(e),f.setOnNodeContextMenu(n),i.current=f,()=>{f.detach(),i.current=void 0,l(Ro(null))}}},o),h.exports.useEffect(()=>{var f;(f=i.current)==null||f.setAssignNewName(m=>{var L,W;const N=m.name,S=(L=g.filter(H=>H.class.id===m.id).length)!=null?L:0,E=(W=ln[S])!=null?W:S;return N+E})},[i,g]),h.exports.useEffect(()=>{i.current&&(i.current.editPayload=K(d)?d:null,i.current.editMode=c)},[c,d,i]);const x=F(qo),C=F(Xt);return h.exports.useEffect(()=>{var f;C&&((f=i.current)==null||f.notifyElementConstrained(C,x.length>0))},[x,i]),{engineRef:i,containerRef:r}};var Me;(function(t){(function(o){o[o.Default=0]="Default",o[o.Reversed=1]="Reversed",o[o.Any=2]="Any"})(t.Direction||(t.Direction={}));const e=o=>o.nodes.map((a,r)=>{var l,c;if(r===o.nodes.length-1)return`(${(l=a.alias)!=null?l:""}:${a.type})`;const i=o.directionToNext[r]===0?"-->":o.directionToNext[r]===1?"<--":"--";return`(${(c=a.alias)!=null?c:""}:${a.type})`+i}).join(""),n=o=>{var a,r;switch(o.logicType){case U.And:return`(${n(o.subClause[0])}) AND (${n(o.subClause[1])})`;case U.Or:return`(${n(o.subClause[0])}) OR (${n(o.subClause[1])})`;case V.Not:return`!(${n(o.subClause[0])})`;default:{const i=o;return`${i.targetId}.${(a=i.property)==null?void 0:a.name} ${ae[(r=i.operator)!=null?r:0]} ${i.value}`}}};t.IR2Cypher=o=>{if(o.structureConstraint.paths.length<=0)return"";const a=`MATCH ${e(o.structureConstraint.paths[0])}
`,r=o.structureConstraint.paths.length<=1?o.structureConstraint.paths.slice(1).map(c=>`WHERE EXISTS {
	${e(c)}
}
`).join("AND "):"",i=o.propertyConstraint?`WHERE {
	${n(o.propertyConstraint)}
}
`:"",l="RETURN ()";return a+r+i+l}})(Me||(Me={}));class oa{constructor(e){u(this,"nodes");u(this,"groups");u(this,"nodeParent");this.nodes=e,this.groups=new Map,this.nodeParent=new Map,e.forEach(n=>{this.groups.set(n.id,[n.id]),this.nodeParent.set(n.id,n.id)})}union(e,n){var l,c;const o=this.nodeParent.get(e.id),a=this.nodeParent.get(n.id);if(o===a)return;const r=(l=this.groups.get(o))!=null?l:[],i=(c=this.groups.get(a))!=null?c:[];i==null||i.forEach(d=>this.nodeParent.set(d,o)),this.groups.set(o,[...r,...i])}SolvedNodes(){var o,a;const e=[...this.groups].map(r=>r[1]),n=$.keyBy(this.nodes,r=>r.id);return(a=(o=$.maxBy(e,r=>r.length))==null?void 0:o.map(r=>n[r]))!=null?a:[]}SolvedId(){const e=[...this.groups].map(n=>n[1]);return $.maxBy(e,n=>n.length)}}const pn=t=>t;class Le{constructor(e,n,o){u(this,"nodes");u(this,"nodeHashMap");u(this,"edges");u(this,"constraintContext");u(this,"_maxSubgraphNodes");u(this,"_maxSubgraphNodeHashMap");u(this,"_maxSubgraphEdges");u(this,"_maxSubgraphEdgeHashMap");u(this,"_maxSubgraphConstraints");u(this,"_maxSubgraphConstraintTreeRootIds");u(this,"_ir");u(this,"generateJSON",async()=>{});u(this,"generateAskGraphAPI",async()=>{});u(this,"generateCypherLang",async()=>{});u(this,"findLargestConnectedNodes",async(e=!1)=>{const n=new oa(this.nodes);this.edges.forEach(a=>{const r=this.nodeHashMap[a.from],i=this.nodeHashMap[a.to];r&&i&&n.union(i,r)});const o=n.SolvedId();return this._maxSubgraphNodes=o==null?void 0:o.map(a=>this.nodeHashMap[a]),this._maxSubgraphNodeHashMap=$.keyBy(this._maxSubgraphNodes,a=>a.id),this._maxSubgraphEdges=this.edges.filter(a=>{var r,i;return((r=this._maxSubgraphNodeHashMap)==null?void 0:r[a.from])!==void 0&&((i=this._maxSubgraphNodeHashMap)==null?void 0:i[a.to])!==void 0}),this._maxSubgraphNodes});u(this,"generatePrunnedPattern",async()=>{await this.findLargestConnectedNodes();debugger;const e=this.constraintContext.constraints.filter(n=>{var o,a;return n.targetType===M.Node&&((o=this._maxSubgraphNodeHashMap)==null?void 0:o[n.targetId])||n.targetType===M.Edge&&((a=this._maxSubgraphEdgeHashMap)==null?void 0:a[n.targetId])});this._maxSubgraphConstraints=e;debugger;return{nodes:this._maxSubgraphNodes.map(n=>({patternId:n.id,type:n.class.name})),edges:this._maxSubgraphEdges.map(n=>({patternId:n.id,fromPatternId:n.from,toPatternId:n.to,type:n.class.name})),constraints:this._maxSubgraphConstraints.map(n=>{var o;return{patternId:n.id,targetType:n.targetType===M.Node?"Node":"Edge",targetPatternId:n.targetId,property:(o=n.property)==null?void 0:o.name,operator:"MatchRegex",value:String(n.value)}})}});u(this,"getIrBySiftedNodes",async(e,n=!1)=>{const o=e.map(y=>y.id),a=this._maxSubgraphEdges,r=this.edges.map(y=>y.id),i=$.groupBy(a,y=>y.from),l=$.groupBy(a,y=>y.to),c=Object.fromEntries(r.map(y=>[y,!1])),d=Object.fromEntries(o.map(y=>[y,!1])),g=y=>{const w=this.nodeHashMap[y].class.name;return{alias:y,type:w}},x=y=>{const w=y.nodes[y.nodes.length-1],v=i[w.alias];if(v){const _=v.find(z=>!c[z.id]);if(_){const z=g(_.to);return c[_.id]=!0,d[_.to]=!0,y.nodes.push(z),y.directionToNext.push(Me.Direction.Default),!0}}const I=l[w.alias];if(I){const _=I.find(z=>!c[z.id]);if(_){const z=g(_.from);return c[_.id]=!0,d[_.from]=!0,y.nodes.push(z),y.directionToNext.push(Me.Direction.Reversed),!0}}return!1},C=()=>{const y={nodes:[],directionToNext:[]},w=o.find(v=>!d[v]);if(w){for(y.nodes.push(g(w)),d[w]=!0;x(y););return y}return null},f=[];for(;;){const y=C();if(!y)break;f.push(y)}const m={propertyConstraint:null,structureConstraint:{paths:f}};this._ir=m;const N=this.constraintContext.constraints.filter(y=>y.targetType===M.Node&&o.includes(y.targetId)||y.targetType===M.Edge&&r.includes(y.targetId));this._maxSubgraphConstraints=N;const S=$.keyBy(N.concat(this.constraintContext.logicOperators),y=>y.id),E=new cn(y=>y.id);E.makeSetByArray(N),E.makeSetByArray(this.constraintContext.logicOperators),this.constraintContext.connections.forEach(y=>{E.union(S[y.to],S[y.from])});const L=Object.keys(E.trees),W=$.groupBy(this.constraintContext.connections,y=>y.to),H=y=>{if(y.targetId)return!!o.includes(y.targetId);{const w=pn(W[y.id]);return y.type===V.Not?(w==null?void 0:w.length)===1?H(S[w[0].from]):!1:(w==null?void 0:w.length)===2?H(S[w[0].from])&&H(S[w[1].from]):!1}},T=y=>{if(y.targetId)return o.includes(y.targetId)?y:null;{const w=pn(W[y.id]);if(y.type===V.Not){if((w==null?void 0:w.length)===1){const v=T(S[w[0].from]);return v===null?null:{logicType:V.Not,subClause:[v]}}return null}else{if((w==null?void 0:w.length)===2){const v=T(S[w[0].from]),I=T(S[w[1].from]);return v===null||I===null?null:{logicType:y.type,subClause:[v,I]}}return null}}};this._maxSubgraphConstraintTreeRootIds=L.filter(y=>H(S[y]));const A=L.map(y=>T(S[y])).filter(y=>y!==null);return A.length>1?m.propertyConstraint={logicType:U.And,subClause:A}:A.length===1&&(m.propertyConstraint=A[0]),m});u(this,"findLargestConnectedContext",async(e=!1)=>{const n=await this.findLargestConnectedNodes();return n?await this.getIrBySiftedNodes(n):null});this.nodes=e,this.edges=n,this.constraintContext=o;debugger;this.nodeHashMap=$.keyBy(e,a=>a.id)}get maxSubgraphNodeCount(){var e;return(e=this._maxSubgraphNodes)==null?void 0:e.length}get maxSubgraphEdgeCount(){var e;return(e=this._maxSubgraphEdges)==null?void 0:e.length}get maxSubgraphConstraintCount(){var e;return(e=this._maxSubgraphConstraints)==null?void 0:e.length}get maxSubgraphConstraintTreeCount(){var e;return(e=this._maxSubgraphConstraintTreeRootIds)==null?void 0:e.length}get ir(){return this._ir}}const sa=t=>{const e=h.exports.useRef(null),n=h.exports.useRef(),o=F(oe.selectAll),a=F(be.selectAll),r=F(Ce.selectAll),[i,l]=h.exports.useState();return h.exports.useEffect(()=>{const c=t.getConstraintContext(),d=c?new Le(o,a,{constraints:r,connections:c.connections,logicOperators:c.logicOperators}):new Le(o,a,{constraints:[],connections:[],logicOperators:[]});d.generatePrunnedPattern().then(g=>{var x,C;if(d.maxSubgraphNodeCount!==void 0&&d.maxSubgraphNodeCount<d.nodes.length||((x=d.maxSubgraphConstraintTreeCount)!=null?x:0)>1){const f=d.maxSubgraphConstraintTreeCount?`\u8FD9\u4E9B\u5C5E\u6027\u7EA6\u675F\u4E2D\u5305\u542B${d.maxSubgraphConstraintTreeCount}\u9897\u72EC\u7ACB\u7684\u903B\u8F91\u6811`+(d.maxSubgraphConstraintTreeCount>1?"\uFF0C\u5B83\u4EEC\u5C06\u88AB\u4EE5\u300C\u4E0E\u300D\u903B\u8F91\u8FD0\u7B97\u7B26\u8FDE\u63A5\u3002":"\u3002"):"";l(`\u751F\u6210\u7684\u8BED\u53E5\u4EC5\u5305\u542B\u6700\u5927\u8FDE\u901A\u5B50\u56FE\u4E2D\u7684${d.maxSubgraphNodeCount}\u4E2A\u8282\u70B9\u3001${d.maxSubgraphEdgeCount}\u6761\u8FB9\u548C\u4EC5\u9488\u5BF9\u5B83\u4EEC\u7684\u5C5E\u6027\u7EA6\u675F\u3002`+f)}(C=n.current)==null||C.setValue(JSON.stringify(g,null,"    "))})},[o,a,r,t.getConstraintContext]),h.exports.useEffect(()=>{if(!!e.current){var c=Rt.createModel("","json"),d=Rt.create(e.current,{model:c,language:"json",fontFamily:'"SFMono", ui-monospace, monospace',fontSize:16,theme:"vs-dark"});return n.current=d,()=>{n.current=void 0,d.dispose()}}},[e]),h.exports.useEffect(()=>{const c=e.current;if(c){const d=new ResizeObserver(g=>{var C;const x=g[0].contentRect;(C=n.current)==null||C.layout(x)});return d.observe(c),()=>{d.unobserve(c)}}},[e]),p("div",{style:{width:"100%",height:"calc(100% - 56px)",position:"relative"},children:[s("div",{ref:e,style:{width:"100%",height:"100%"}}),i&&p("div",{style:{position:"absolute",bottom:0,height:36,fontSize:12,display:"flex",alignItems:"center",width:"100%",padding:"0 16px",columnGap:8,background:"rgb(208,82,32)",color:"#fff"},children:[s(jn,{fill:"#fff"}),X.spacing(i)]})]})},aa=t=>[{id:"out_1",group:"group1",args:{x:t!=null?t:192,y:14}},{id:"in_1",group:"group2",args:{x:0,y:8}},{id:"in_2",group:"group2",args:{x:0,y:20}}],ra=t=>[{id:"out_1",group:"group1",args:{x:t!=null?t:192,y:14}},{id:"in_1",group:"group2",args:{x:0,y:14}}],ft=(t,e,n,o=2,a=1,r,i,l,c)=>t.addNode(P(D({width:l!=null?l:192,height:28,x:240,y:16},c),{label:e,id:n,attrs:{label:{refX:8,refY:15,textAnchor:"start",textVerticalAnchor:"middle",fontFamily:"var(--mono-font)",fontFeatureSetting:'"liga" 1',fill:r!=null?r:"#000",fontWeight:600},body:{stroke:r!=null?r:"#919297",fill:i!=null?i:"#fff",strokeWidth:2,rx:4,ry:4}},ports:{groups:{group1:{attrs:{circle:{r:4,magnet:!0,stroke:r!=null?r:"#919297",strokeWidth:2,fill:"#fff"}},position:{name:"absolute"}},group2:{attrs:{circle:{r:4,magnet:!0,stroke:r!=null?r:"#919297",strokeWidth:2,fill:"#fff"}},position:{name:"absolute"}}},items:o===1?ra(l):aa(l)}})),mt=(t,e,n)=>ft(t,"\u4E0E",e,2,1,"#EF6C00","#FFF8E1",64,n),yt=(t,e,n)=>ft(t,"\u6216",e,2,1,"#0277BD","#E1F5FE",64,n),xt=(t,e,n)=>ft(t,"\u975E",e,1,1,"#512DA8","#EDE7F6",64,n),ia=t=>new qn({container:t,grid:16,connecting:{allowLoop:!1,allowMulti:!1,allowEdge:!1,allowNode:!1,allowPort:!0,router:{name:"manhattan",args:{padding:16}},connector:{name:"rounded",args:{radius:8}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,createEdge(){return new Gn({attrs:{line:{stroke:"#919297",strokeWidth:2,targetMarker:{name:"block",width:12,height:8}}},zIndex:0})},validateConnection(e){var n,o;return((n=e==null?void 0:e.sourceCell)==null?void 0:n.id)&&((o=e==null?void 0:e.targetCell)==null?void 0:o.id)&&console.log(e.sourceCell.id,e.targetCell.id),!!e.targetMagnet}}}),gn=t=>({refX:8,refY:15,textAnchor:"start",textVerticalAnchor:"middle",fontFamily:"var(--mono-font)",fontFeatureSetting:'"liga" 1',text:t}),fn=t=>{var e,n,o,a,r,i;if(t.changes){const l=t.changes;return(l.expression||l.property)&&K(l.operator)&&K(l.value)?`${(n=l.expression)!=null?n:(e=l.property)==null?void 0:e.name} ${ae[(o=l.operator)!=null?o:0]} ${l.value}`:""}else{const l=t;return(l.expression||l.property)&&K(l.operator)&&l.value?`${(r=l.expression)!=null?r:(a=l.property)==null?void 0:a.name} ${ae[(i=l.operator)!=null?i:0]} ${l.value}`:""}},mn=(t,e,n)=>t.addNode(P(D({data:{labelText:""},id:e.id,width:192,height:28,x:16,y:16},n),{attrs:{label:gn(fn(e)),body:{stroke:"#e1e2e5",fill:"#fff",strokeWidth:1,rx:4,ry:4}},ports:{groups:{group1:{attrs:{circle:{r:4,magnet:!0,stroke:"#919297",strokeWidth:2,fill:"#fff"},text:{fontSize:12,fill:"#888"}},position:{name:"absolute"}}},items:[{id:"out_1",group:"group1",args:{x:192,y:14}}]}})),la=(t,e)=>{const n=fn(e);t.replaceAttrs({label:gn(n)})};const da={top:nt-Wt,right:nt-zt},ca=t=>{const e=q(),n=F(jo),o=F(Fe),a=F(rt),r=h.exports.useRef(null),[i,l]=h.exports.useState(!1);return h.exports.useEffect(()=>{i?document.body.className="cursor-ns":document.body.className=""},[i]),p("div",{className:"global-panel-root panel",ref:r,style:{height:n,left:o,width:`calc(100% - ${a+o}px)`},children:[t.children,s(Je,{axis:"y",onDrag:(c,d)=>{e(Po(n-d.y))},onStart:()=>{l(!0)},onStop:(c,d)=>{l(!1)},position:{x:0,y:0},bounds:da,children:s("div",{className:"global-panel-handler",style:{backgroundColor:i?"var(--primary)":void 0}})})]})},ua=(t,e)=>{const n=e.constraints.map((a,r)=>mn(t,a,{x:16,y:16+48*r})),o=e.logicOperators.map((a,r)=>{switch(a.type){case V.Not:return xt(t,a.id,{x:240,y:16+48*r});case U.And:return mt(t,a.id,{x:240,y:16+48*r});case U.Or:return yt(t,a.id,{x:240,y:16+48*r})}});$.keyBy(n.concat(o),a=>a.id)},ha=te.forwardRef((t,e)=>{const n=F(po),o=h.exports.useRef(null),a=h.exports.useRef(null),r=h.exports.useRef(),i=h.exports.useRef(),l=h.exports.useRef(new Map);h.exports.useEffect(()=>{const C=o.current;if(C){const f=ia(C);return i.current=f,r.current=new Set,()=>{var m;f==null||f.dispose(),i.current=void 0,(m=r.current)==null||m.clear(),r.current=void 0}}},[o]),h.exports.useEffect(()=>{i.current&&t.initialContext&&ua(i.current,t.initialContext)},[t.initialContext,i]),h.exports.useEffect(()=>{var C,f,m,N;if(n&&i.current)switch(n.action){case"addOne":{const S=n.payload.payload,E=mn(i.current,S);(C=l.current)==null||C.set(S.id,E);break}case"removeOne":{(m=(f=l.current)==null?void 0:f.get(n.payload.payload))==null||m.remove();break}case"updateOne":{const S=n.payload.payload,E=(N=l.current)==null?void 0:N.get(S.id);E&&la(E,S);break}}},[n,i]);const c=q();h.exports.useImperativeHandle(e,()=>({getConstraintContext:()=>{const C=i.current;if(C&&r.current){const f=C.getEdges().map(m=>({from:m.getSourceCellId(),to:m.getTargetCellId()}));return{logicOperators:[...r.current],connections:f}}return null}}),[i,r]);const[d,g]=h.exports.useState(!1),x=h.exports.useRef(null);return h.exports.useEffect(()=>{if(i.current&&a.current){const C=new ResizeObserver($.debounce(f=>{var m;(m=i.current)==null||m.resize(f[0].contentRect.width,f[0].contentRect.height)},200));return C.observe(a.current),()=>{a.current&&C.unobserve(a.current)}}},[i]),p(ca,{children:[s(J,{text:"\u5168\u5C40\u903B\u8F91",children:p("div",{style:{display:"flex",columnGap:8,fontSize:13,alignItems:"center"},children:[s("span",{style:{color:"var(--grey200)",paddingRight:8,fontWeight:400},children:"\u6DFB\u52A0\u903B\u8F91\u8FD0\u7B97"}),s(Q,{disableRipple:!0,ref:x,onClick:C=>{var m;const f={type:U.And,id:j()};(m=r.current)==null||m.add(f),i.current&&mt(i.current,f.id),g(!1)},style:{fontSize:13,fontWeight:600},children:"\u4E0E"}),s(Q,{disableRipple:!0,ref:x,onClick:C=>{var m;const f={type:U.Or,id:j()};(m=r.current)==null||m.add(f),i.current&&yt(i.current,f.id),g(!1)},style:{fontSize:13,fontWeight:600},children:"\u6216"}),s(Q,{disableRipple:!0,ref:x,onClick:C=>{var m;const f={type:V.Not,id:j()};(m=r.current)==null||m.add(f),i.current&&xt(i.current,f.id),g(!1)},style:{fontSize:13,fontWeight:600},children:"\u975E"})]})}),s("div",{className:"constraint-pool-root",ref:a,children:s("div",{className:"x6-container",ref:o})}),p("div",{style:{display:"flex",columnGap:8,position:"absolute",right:8,bottom:8,width:"100%",justifyContent:"flex-end"},children:[s(Oe,{activated:!1,autoLength:!0,forcedHighlight:!0,text:"\u4FDD\u5B58",style:{color:"#fff",marginRight:8,padding:"0 24px"},onClick:C=>c(ot(!0)),children:s(Ve,{fill:"#fff"})}),s(Oe,{activated:!1,hint:"\u5339\u914D\u67E5\u8BE2",shortcut:" Enter",cmd:!0,autoLength:!0,forcedHighlight:!0,text:"\u67E5\u8BE2",style:{color:"#fff",marginRight:8,padding:"0 24px"},onClick:C=>c(ot(!0)),children:s(Ve,{fill:"#fff"})})]}),s(ee,{target:x.current,isBeakVisible:!1,hidden:!0,styles:{calloutMain:{borderRadius:0,minWidth:120}},directionalHint:re.bottomRightEdge,children:p("div",{style:{background:"#212224",padding:"8px 1px",borderRadius:0,maxHeight:"90vh",overflow:"auto"},children:[p("li",{className:"contextual-menu-item",onClick:C=>{var m;const f={type:U.And,id:j()};(m=r.current)==null||m.add(f),i.current&&mt(i.current,f.id),g(!1)},children:[s("span",{children:"\u4E0E"}),s("span",{style:{opacity:.25},className:"shimmed",children:"A"})]}),p("li",{className:"contextual-menu-item",style:{},onClick:C=>{var m;const f={type:U.Or,id:j()};(m=r.current)==null||m.add(f),i.current&&yt(i.current,f.id),g(!1)},children:[s("span",{children:"\u6216"}),s("span",{style:{opacity:.25},className:"shimmed",children:"O"})]}),s("div",{style:{height:1,margin:"8px 0",background:"#313235"}}),p("li",{className:"contextual-menu-item",style:{},onClick:C=>{var m;const f={type:V.Not,id:j()};(m=r.current)==null||m.add(f),i.current&&xt(i.current,f.id),g(!1)},children:[s("span",{children:"\u975E"}),s("span",{style:{opacity:.25},className:"shimmed",children:"N"})]})]})})]})});var vt;(function(t){let e;(function(n){n.And="And",n.Or="Or",n.Not="Not",n.Xor="Xor",n.Xnor="Xnor"})(e||(e={})),t.LogicOperator2Literal={[U.And]:e.And,[U.Or]:e.Or,[V.Not]:e.Not}})(vt||(vt={}));const pa=async t=>(postMessage(t),(await Ft.post("/api/solveCompositePattern",t)).data),ga=t=>{const e=t.map(l=>l.position.x),n=t.map(l=>l.position.y),o=Math.min(...n),a=Math.max(...n),r=Math.min(...e),i=Math.max(...e);return{top:o,bottom:a,left:r,right:i}};class yn{constructor(e,n,o={width:320,height:240},a=20,r=1){u(this,"patternNodes");u(this,"padding");u(this,"box");u(this,"layouts");u(this,"patternEdges");u(this,"_scale",1);u(this,"workspaceNodeInvertedIndex");u(this,"workspaceEdgeInvertedIndex");u(this,"paintOnUnsolved",e=>{const n=xe(e).classed("transformed",!0),o=n.append("g");return Object.entries(this.patternEdges).forEach(a=>{const r=this.workspaceEdgeInvertedIndex[a[1].id];(r==null?void 0:r.length)>=2&&new ue(this.layouts[r[0]],this.layouts[r[1]],7,!0,"narrowed").attachTo(o)}),n.append("g").selectAll("circle").data(this.patternNodes).enter().append("circle").attr("r",5).attr("cx",(a,r)=>this.layouts[r].x).attr("cy",(a,r)=>this.layouts[r].y).attr("fill",(a,r)=>this.patternNodes[r].class.colorSlot.primary),n.append("g").selectAll("text").data(this.patternNodes).enter().append("text").classed("class-text",!0).attr("x",(a,r)=>this.layouts[r].x).attr("y",(a,r)=>this.layouts[r].y+5.5).attr("fill",(a,r)=>this.patternNodes[r].class.colorSlot.darkened).text(a=>a.class.name),()=>{e.innerHTML=""}});u(this,"paintOn",(e,n)=>{const o=this.patternNodes.map(i=>n.nodes[i.id]),a=xe(e),r=a.append("g");return Object.entries(n.edges).forEach(i=>{new ue(this.layouts[this.workspaceEdgeInvertedIndex[i[0]][0]],this.layouts[this.workspaceEdgeInvertedIndex[i[0]][1]],12,!0).attachTo(r)}),a.append("g").selectAll("circle").data(o).enter().append("circle").attr("r",8).attr("cx",(i,l)=>this.layouts[l].x).attr("cy",(i,l)=>this.layouts[l].y).attr("fill",(i,l)=>this.patternNodes[l].class.colorSlot.primary),a.append("g").selectAll("text").data(o).enter().append("text").classed("instance-text",!0).attr("x",(i,l)=>this.layouts[l].x).attr("y",(i,l)=>this.layouts[l].y+10).attr("fill",(i,l)=>this.patternNodes[l].class.colorSlot.constrained).text(i=>i.name),()=>{a.selectAll("*").remove()}});this.patternNodes=e,this.patternEdges=n,this.box=o,this.padding=a,this.layouts=this.getLayouts(r)}getLayouts(e){const n=ga(this.patternNodes),o=this.padding,a=this.box.height-this.padding,r=this.padding,i=this.box.width-this.padding,l=n.right-n.left+4,c=n.bottom-n.top+4,d=(i-r)/l,g=(a-o)/c,x=Math.min(d,g)*e;this._scale=x;const C=(n.left+n.right)/2,f=(n.bottom+n.top)/2,m=E=>(E-f)*x+this.box.height/2,N=E=>(E-C)*x+this.box.width/2,S=this.patternNodes.map(E=>({x:N(E.position.x),y:m(E.position.y)}));return this.workspaceNodeInvertedIndex=Object.fromEntries(this.patternNodes.map((E,L)=>[E.id,L])),this.workspaceEdgeInvertedIndex=Object.fromEntries(this.patternEdges.map((E,L)=>[E.id,[this.workspaceNodeInvertedIndex[E.from],this.workspaceNodeInvertedIndex[E.to]]])),S}}const fa=t=>{const e=h.exports.useRef(null);return h.exports.useEffect(()=>{if(e.current)return t.onPaint(e.current)},[t.onPaint,e]),s("svg",{ref:e,width:320,height:240,style:{backgroundColor:"#f8f9fa"}})},ma=t=>{const e=F(oe.selectAll),n=F(be.selectAll),o=h.exports.useMemo(()=>new yn(e,n),[t.solutions]),a=te.useMemo(()=>$.chunk(t.solutions,4),[t.solutions]);return s(Un,{children:({height:r,width:i})=>s(Jn,{itemSize:256,itemCount:a.length,height:r,width:i,children:l=>s("div",{style:D({display:"grid",gridTemplateColumns:`repeat(${t.columnCount}, 320px)`,paddingLeft:16,paddingRight:16,columnGap:16},l.style),children:a[l.index].map(c=>s(fa,{style:l.style,onPaint:d=>o.paintOn(d,c)}))})})})};var xn;(function(t){t[t.ValidatingInput=0]="ValidatingInput",t[t.SendingRequest=1]="SendingRequest",t[t.SolvingResponse=2]="SolvingResponse"})(xn||(xn={}));const ya=t=>{const e=q(),n=F(oe.selectAll),o=F(be.selectAll),a=F(Ce.selectAll),[r,i]=h.exports.useState(0),[l,c]=h.exports.useState();return h.exports.useEffect(()=>{const d=t.getConstraintContext();console.log(d);const g=d?new Le(n,o,{constraints:a,connections:d.connections,logicOperators:d.logicOperators}):new Le(n,o,{constraints:[],connections:[],logicOperators:[]});i(0),g.generatePrunnedPattern().then(async x=>{var m,N,S;(g.maxSubgraphNodeCount!==void 0&&g.maxSubgraphNodeCount<g.nodes.length||((m=g.maxSubgraphConstraintTreeCount)!=null?m:0)>1)&&g.maxSubgraphConstraintTreeCount&&`\u8FD9\u4E9B\u5C5E\u6027\u7EA6\u675F\u4E2D\u5305\u542B${g.maxSubgraphConstraintTreeCount}\u9897\u72EC\u7ACB\u7684\u903B\u8F91\u6811`+(g.maxSubgraphConstraintTreeCount>1?"\uFF0C\u5B83\u4EEC\u5C06\u88AB\u4EE5\u300C\u4E0E\u300D\u903B\u8F91\u8FD0\u7B97\u7B26\u8FDE\u63A5\u3002":"\u3002"),i(1);const C=P(D({},x),{connections:(N=d==null?void 0:d.connections)!=null?N:[],logicOperators:(S=d==null?void 0:d.logicOperators.map(E=>({patternId:E.id,type:vt.LogicOperator2Literal[E.type]})))!=null?S:[]});console.log(C,top),top==null||top.postMessage(C);const f=await pa(C);t.onSaveHistory(P(D({},f),{queryTimestamp:new Date().getTime()})),i(2)})},[n,o,a,t.getConstraintContext]),p(O,{children:[s("div",{style:{left:0,top:0,width:"100vw",height:"100vh",backgroundColor:"#20222a60",fontSize:14,position:"absolute",zIndex:99998}}),p("div",{style:{left:"calc(50vw - 680px)",top:"14vh",width:"1360px",height:"72vh",backgroundColor:"#fff",fontSize:14,padding:0,position:"absolute",zIndex:99999,boxShadow:"rgba(0, 0, 0, 0.133) 0px 6.390625px 14px 0px, rgba(0, 0, 0, 0.11) 0px 1.1875px 3px 0px"},children:[p("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",padding:"8px"},children:[s("div",{style:{display:"flex",color:"#000"},children:s(J,{text:r==0?"\u6B63\u5728\u89E3\u6790\u7EA6\u675F":r==1?"\u6B63\u5728\u67E5\u8BE2":`\u67E5\u8BE2\u5230${l==null?void 0:l.solutions.length}\u4E2A\u5339\u914D, \u67E5\u8BE2\u6570\u636E\u5E93\u7528\u65F6${l==null?void 0:l.elapsedTimeInMillis}ms`,topUnpadded:!0})}),s("div",{style:{display:"flex"},children:s(Q,{onClick:d=>e(ot(!1)),children:s(ye,{})})})]}),l!==void 0&&s("div",{style:{fontFamily:"var(--mono-font)",color:"#fff",height:"calc(72vh - 56px)",overflowY:"auto"},children:s(ma,{solutions:l.solutions,columnCount:4})}),r==1&&s("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 320px)",columnGap:16,padding:"0 16px",rowGap:16,overflow:"hidden",height:"calc(72vh - 56px)"},children:new Array(12).fill(0).map(d=>s(Kn,{variant:"rectangular",width:320,height:240,style:{borderRadius:0,backgroundColor:"#f1f2f4"},animation:"wave"}))})]})]})},xa={overviews:[]},vn=ge({name:"overview",initialState:xa,reducers:{setOverviews:(t,e)=>{t.overviews=e.payload},deleteFile:(t,e)=>{const n=t.overviews.findIndex(r=>r.dataSource.id===e.payload.dataSourceId),o=t.overviews[n].queries.findIndex(r=>r.id==e.payload.id),a=t.overviews[n].queries;t.overviews[n].queries=[...a.slice(0,o),...a.slice(o+1,a.length)],ie.removeItem(e.payload.id)},renameFile:(t,e)=>{}}}),{setOverviews:va,deleteFile:Ca}=vn.actions,Ea=()=>async(t,e)=>{const n=await Eo(),o=await wo(n);t(va(o))},Cn=(t,e,n)=>async(o,a)=>{const r=await le.getItem(e);if(r){const i=new Date().getTime();o(et({ids:[],entities:{}})),o(Qe({ids:[],entities:{}})),o(Xe({ids:[],entities:{}})),o(st({model:null,editMode:k.CreatingNode,projectName:r.name,workspaceName:n,createTime:i,lastModifiedTime:i,dataSourceId:e,fileId:t}));const l=await Re();o(Te(l))}},ba=(t,e)=>async(n,o)=>{var r;const a=await ie.getItem(t);if(a){const i=await Re(),l=await le.getItem(a.dataSourceId);n(et(a.nodes)),n(Qe(a.edges)),n(Xe(a.constraints)),n(st({model:null,editMode:k.CreatingNode,projectName:(r=l==null?void 0:l.name)!=null?r:"ERROR DATABASE",workspaceName:a.name,createTime:a.createTime,lastModifiedTime:a.lastEditTime,dataSourceId:a.dataSourceId,fileId:t})),n(Te(i)),e(a)}},Sa=(t,e)=>async(n,o)=>{var i;ie.setItem(t.id,t);const a=await le.getItem(t.dataSourceId);n(et(t.nodes)),n(Qe(t.edges)),n(Xe(t.constraints)),n(st({model:null,editMode:k.CreatingNode,projectName:(i=a==null?void 0:a.name)!=null?i:"ERROR DATABASE",workspaceName:t.name,createTime:t.createTime,lastModifiedTime:t.lastEditTime,dataSourceId:t.dataSourceId,fileId:t.id})),e();const r=await Re();n(Te(r))},Ct=t=>t.overview.overviews;var wa=vn.reducer;const Fa=()=>{var H,T;const t=q(),e=Ae(),n=F(_e),o=F(Fe),a=F(rt),[r,i]=h.exports.useState(!1),[l,c]=h.exports.useState(),{state:d}=Vn(),[g,x]=h.exports.useState(),[C,f]=h.exports.useState(),{engineRef:m,containerRef:N}=na(n,(...A)=>{c(P(D({},A),{timestamp:new Date().getTime()})),i(!0)},(A,y)=>{x({node:A,event:y})},[n]);h.exports.useEffect(()=>{var A;C&&((A=m.current)==null||A.restoreFromFile(C))},[C]),h.exports.useEffect(()=>{if(console.log(d),d==null?void 0:d.fileId)return t(ba(d.fileId,A=>{f(A)})),n||Re().then(A=>Te(A)),()=>{t(To())};e("/")},[]);const S=F(Mo),E=h.exports.useRef(null),L=h.exports.useCallback(()=>E.current?E.current.getConstraintContext():null,[E]),W=F(Lo);return h.exports.useEffect(()=>{const A=()=>{var w;t(Gt((w=L())!=null?w:void 0))},y=$.debounce(()=>{setTimeout(()=>{var w;return t(Gt((w=L())!=null?w:void 0))},100)},400);return window.addEventListener("unload",A),window.addEventListener("blur",A),window.addEventListener("click",y),()=>{window.removeEventListener("unload",A),window.removeEventListener("blur",A),window.removeEventListener("click",y)}},[]),p(O,{children:[s(As,{}),p("div",{className:"workspace-container",children:[r&&s(Xn,{anchorOrigin:{vertical:"top",horizontal:"left"},open:!0,autoHideDuration:3e3,onClose:A=>i(!1),style:{top:48,left:o,zIndex:1},children:p("div",{className:"global-message",style:{width:`calc(100vw - ${o+a}px)`},children:[s(Qn,{fill:"#EB5757"}),s("div",{dangerouslySetInnerHTML:{__html:(H=l==null?void 0:l[0])!=null?H:""}})]})}),s("div",{ref:N,className:"engine-root-container"}),s(Bs,{}),s(Ys,{engineRef:m}),s(ha,{ref:E,initialContext:C?So(C):void 0})]}),((T=g==null?void 0:g.node)==null?void 0:T.renderElements)&&p(ee,{target:g==null?void 0:g.event,directionalHint:re.bottomLeftEdge,onDismiss:A=>x(void 0),theme:Y,beakWidth:0,calloutMaxWidth:320,styles:{calloutMain:{borderRadius:0,padding:"8px 0"}},children:[p("div",{className:"contextual-callout-item",style:{pointerEvents:"none",fontWeight:600,color:"var(--grey700)"},children:[s("div",{children:"\u8FDE\u63A5"}),s("span",{className:"contextual-callout-item-helper"})]}),p("div",{className:"contextual-callout-item",onClick:A=>{var y;(y=m.current)==null||y.setEditModeWithPayload(k.CreatingEdgeTo,g==null?void 0:g.node.uuid)},style:{},children:[s("div",{style:{fontSize:13},children:"\u8FDE\u63A5\u5230\u5DF2\u6709\u8282\u70B9"}),s("span",{className:"contextual-callout-item-helper"})]}),p("div",{className:"contextual-callout-item",style:{},children:[s("div",{style:{fontSize:13},children:"\u8FDE\u63A5\u5230\u65B0\u7684\u8282\u70B9"}),s("span",{className:"contextual-callout-item-helper"})]}),s("div",{className:"contextual-callout-sep"}),s("div",{className:"contextual-callout-item",style:{pointerEvents:"none",fontWeight:600,color:"var(--grey700)"},children:s("div",{children:"\u7EA6\u675F"})}),s("div",{className:"contextual-callout-item",style:{},children:s("div",{style:{fontSize:13},children:"\u6DFB\u52A0\u7EA6\u675F"})}),s("div",{className:"contextual-callout-item",style:{},children:s("div",{style:{fontSize:13},children:"\u79FB\u9664\u6240\u6709\u7EA6\u675F"})}),s("div",{className:"contextual-callout-sep"}),s("div",{className:"contextual-callout-item",style:{},children:s("div",{style:{fontSize:13},children:"\u7F29\u5C0F\u5339\u914D\u8303\u56F4"})}),s("div",{className:"contextual-callout-sep"}),p("div",{className:"contextual-callout-item",style:{},children:[s("div",{style:{fontSize:13},children:"\u79FB\u9664\u8282\u70B9"}),s("span",{className:"contextual-callout-item-helper"})]})]}),S!==void 0&&p(O,{children:[s("div",{style:{left:0,top:0,width:"100vw",height:"100vh",backgroundColor:"#20222a60",fontSize:14,position:"absolute",zIndex:99998}}),p("div",{style:{left:"10vw",top:"14vh",width:"80vw",height:"72vh",backgroundColor:"#1e1e1e",fontSize:14,padding:0,position:"absolute",zIndex:99999,boxShadow:"rgba(0, 0, 0, 0.133) 0px 6.390625px 14px 0px, rgba(0, 0, 0, 0.11) 0px 1.1875px 3px 0px"},children:[p("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",padding:"8px"},children:[p("div",{style:{display:"flex",color:"#fff"},children:[s(J,{text:"JSON",dimmed:S!=="JSON",topUnpadded:!0}),s(J,{text:"Cypher",dimmed:S!=="Cypher",topUnpadded:!0})]}),s("div",{style:{display:"flex"},children:s(Os,{onClick:A=>t(Kt(void 0)),children:s(ye,{fill:"#fff"})})})]}),s(sa,{getConstraintContext:L})]})]}),W&&s(ya,{getConstraintContext:L,onSaveHistory:A=>{(d==null?void 0:d.fileId)&&tt.setItem(d.fileId,A)}})]})},Na=B(Z)(t=>({color:"#fff",fontSize:13,margin:8,marginLeft:0,borderRadius:2,padding:"8px 16px",width:576,minHeight:0,height:"calc(100% - 16px)",transition:"width 0.2s",display:"flex",flexDirection:"row-reverse",columnGap:12,"&.Mui-focused":{backgroundColor:"#88888860",width:872},"&>input":{color:"#fff",padding:"0 0 0 0"},"&:hover":{backgroundColor:"#88888860"}})),ka=()=>{const t=F(Fe);return p("div",{className:"ideograph-header",style:{gridTemplateColumns:`${t}px 26px 1fr`},children:[s(Oe,{activated:!1,style:{marginLeft:4},children:s(Yn,{src:"/static/ideograph.png",width:24,height:24})}),s("div",{style:{height:"100%",width:1,backgroundColor:"#00000080"}}),s(Na,{renderSuffix:e=>s(Ve,{fill:"#888888"}),placeholder:"\u641C\u7D22\u6570\u636E\u6E90\u3001\u67E5\u8BE2\u5386\u53F2\u6216\u67E5\u8BE2\u7ED3\u679C..."})]})},Aa=B("div")(t=>({height:36,width:"100%",display:"flex",alignItems:"center",columnGap:8,padding:"0 0px",fontFamily:"var(--font)",fontSize:13})),Da=B("div")(t=>({height:"100%",width:"100%",display:"flex",alignItems:"center",columnGap:8,padding:"0 8px",fontFamily:"var(--font)",fontSize:13})),Ia=t=>{var e;return p(Aa,{children:[s("span",{children:t==null?void 0:t.text}),s("span",{style:{fontFamily:"var(--mono-font)",color:"#888888e0"},children:(e=t==null?void 0:t.data)==null?void 0:e.mongo.hostAddress})]})},Ra=t=>{var e;return p(Da,{children:[s("span",{children:t==null?void 0:t.text}),s("span",{style:{fontFamily:"var(--mono-font)",color:"#888888e0"},children:(e=t==null?void 0:t.data)==null?void 0:e.mongo.hostAddress})]})},Ta=t=>{const e=F(Ct),[n,o]=h.exports.useState(X.spacing(`\u67E5\u8BE2${$.sum(e.map(d=>d.queries.length))+1}`)),[a,r]=h.exports.useState(e[0].dataSource.id),i=h.exports.useRef(null),l=q(),c=Ae();return h.exports.useEffect(()=>{var d;(d=i==null?void 0:i.current)==null||d.select()},[]),p(O,{children:[s("div",{style:{left:0,top:0,width:"100vw",height:"100vh",backgroundColor:"#20222a80",fontSize:14,position:"absolute",zIndex:98}}),p("div",{style:{left:"calc(50vw - 300px)",top:"30vh",width:600,height:"auto",backgroundColor:"#fff",fontSize:14,padding:0,position:"absolute",zIndex:99,boxShadow:"rgba(0, 0, 0, 0.133) 0px 6.390625px 14px 0px, rgba(0, 0, 0, 0.11) 0px 1.1875px 3px 0px"},children:[p("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",padding:"8px"},children:[s("div",{style:{display:"flex"},children:s(J,{text:"\u65B0\u5EFA\u67E5\u8BE2",topUnpadded:!0})}),s("div",{style:{display:"flex"},children:s(Q,{onClick:t.onDismiss,children:s(ye,{})})})]}),p("div",{style:{display:"grid",rowGap:16,padding:24,fontSize:13,gridTemplateColumns:"120px 1fr auto",columnGap:16,alignItems:"center"},children:[p("span",{children:["\u67E5\u8BE2\u540D\u79F0",s("span",{style:{color:"red",paddingLeft:2},children:"*"})]}),s(se,{onMouseUp:d=>d.target.select(),value:n,style:{gridColumnEnd:4,gridColumnStart:2},onChange:d=>{var g;return o((g=d.target.value)!=null?g:X.spacing(`\u67E5\u8BE2${$.sum(e.map(x=>x.queries.length))}`))},inputRef:i}),p("span",{children:["\u5C06\u8981\u8FDE\u63A5\u7684\u6570\u636E\u5E93",s("span",{style:{color:"red",paddingLeft:2},children:"*"})]}),s(Zn,{calloutProps:it,styles:{title:{height:36,border:"1px solid transparent",background:"var(--grey50)",color:"#000!important",borderRadius:3,padding:0},dropdown:{height:36,padding:0,borderRadius:3},dropdownItem:{height:36,padding:0,borderRadius:3},callout:{borderRadius:3},caretDownWrapper:{height:"100%",display:"inline-flex",alignItems:"center",borderRadius:3},dropdownItemsWrapper:{height:36,padding:0,borderRadius:3},dropdownItems:{height:36,padding:0,borderRadius:3},dropdownItemSelected:{height:36,background:"var(--primary)!import",borderRadius:3}},onRenderCaretDown:d=>s(qe,{fill:"#000",style:{verticalAlign:"center"}}),options:e.map(d=>({key:d.dataSource.id,text:d.dataSource.name,data:d.dataSource})),selectedKey:a,onChange:(d,g)=>g&&r(g.key),onRenderOption:Ia,theme:Y,onRenderTitle:d=>d?s(Ra,D({},d[0])):s(O,{})}),p(Ne,{disabled:!0,children:[s(Ue,{}),"\u8FDE\u63A5\u5230\u65B0\u6570\u6E90"]})]}),p("div",{style:{display:"flex",justifyContent:"flex-end",columnGap:16,padding:"36px 24px 24px"},children:[s(Ne,{style:{width:"100%"},onClick:t.onDismiss,children:"\u53D6\u6D88"}),s(Pe,{style:{width:"100%"},onClick:()=>{const d=j();l(Cn(d,a,n)),c(`file?fileId=${d}`,{state:{fileId:d}})},children:"\u786E\u5B9A"})]})]})]})},_a=t=>{const e=F(Ct),[n,o]=h.exports.useState(X.spacing(`\u6570\u636E\u6E90${e.length+1}`)),[a,r]=h.exports.useState(e[0].dataSource.id),i=h.exports.useRef(null),l=q();return h.exports.useEffect(()=>{var c;(c=i==null?void 0:i.current)==null||c.select()},[]),p(O,{children:[s("div",{style:{left:0,top:0,width:"100vw",height:"100vh",backgroundColor:"#20222a80",fontSize:14,position:"absolute",zIndex:98}}),p("div",{style:{left:"calc(50vw - 300px)",top:"30vh",width:600,height:"auto",backgroundColor:"#fff",fontSize:14,padding:0,position:"absolute",zIndex:99,boxShadow:"rgba(0, 0, 0, 0.133) 0px 6.390625px 14px 0px, rgba(0, 0, 0, 0.11) 0px 1.1875px 3px 0px"},children:[p("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",padding:"8px"},children:[s("div",{style:{display:"flex"},children:s(J,{text:"\u8FDE\u63A5\u5230\u65B0\u6570\u636E\u6E90",topUnpadded:!0})}),s("div",{style:{display:"flex"},children:s(Q,{onClick:t.onDismiss,children:s(ye,{})})})]}),p("div",{style:{display:"grid",rowGap:16,padding:24,fontSize:13,gridTemplateColumns:"120px 1fr auto",columnGap:16,alignItems:"center"},children:[p("span",{children:["\u6570\u636E\u6E90\u540D\u79F0",s("span",{style:{color:"red",paddingLeft:2},children:"*"})]}),s(se,{onMouseUp:c=>c.target.select(),value:n,style:{gridColumnEnd:4,gridColumnStart:2},onChange:c=>{var d;return o((d=c.target.value)!=null?d:"\u65B0\u6570\u636E\u6E90")},inputRef:i}),p("span",{children:["MongoDB",s("span",{style:{color:"red",paddingLeft:2},children:"*"})]}),s(se,{onMouseUp:c=>c.target.select(),style:{gridColumnEnd:4,gridColumnStart:2}}),s("span",{children:"Dgraph"}),s(se,{onMouseUp:c=>c.target.select(),style:{gridColumnEnd:4,gridColumnStart:2}})]}),p("div",{style:{display:"flex",justifyContent:"flex-end",columnGap:16,padding:"36px 24px 24px"},children:[s(Ne,{style:{width:"100%"},onClick:t.onDismiss,children:"\u53D6\u6D88"}),s(Pe,{style:{width:"100%"},onClick:()=>{const c=j();l(Cn(c,a,n)),t.onDismiss()},children:"\u786E\u5B9A"})]})]})]})},Ba=t=>{const e=h.exports.useRef(null);return h.exports.useEffect(()=>{if(e.current)return new yn(Object.values(t.file.nodes.entities),Object.values(t.file.edges.entities),{width:280,height:112},18).paintOnUnsolved(e.current)},[e]),s("svg",{ref:e,width:280,height:112})},Oa=Ie(me)(t=>({fontSize:13,width:"100%",height:42,textAlign:"left",color:"var(--grey700)",borderRadius:0,justifyContent:"flex-start",padding:16,"&:hover":{backgroundColor:"var(--grey50)"}}));Ie(Oa)(t=>({color:"var(--primary)",background:"#1870fb20","&:hover":{background:"#1870fb28"},"&:active":{background:"#1870fb28"}}));const Et=Ie(me)(t=>({textTransform:"none",color:"#000",background:"#fff",border:"1px solid var(--grey100)",borderRadius:4,width:"100%",height:120,display:"grid",gridTemplateColumns:"48px 1fr",columnGap:16,alignItems:"center",justifyContent:"left",padding:16,textAlign:"left","&:hover":{background:"var(--grey20)"},"&:active":{background:"var(--grey20)"},overflow:"hidden",transition:"background 0.1s","&.Mui-disabled":{border:"1px solid transparent",background:"var(--grey20)","&>*":{opacity:.6}}})),Pa=Ie(Et)(t=>({display:"grid",overflow:"hidden",gridTemplateColumns:"1fr",gridTemplateRows:"1fr 24px 18px",height:180,alignItems:"inherit"})),En=Intl.DateTimeFormat("zh-CN",{month:"long",day:"numeric",hour:"numeric",minute:"2-digit"});function $a(){const t=F(Fe),[e,n]=h.exports.useState(0),[o,a]=h.exports.useState(),r=h.exports.useRef(null),i=q(),l=Ae();kt("Ideograph"),h.exports.useEffect(()=>{i(Ea()),bo(tt).then(f=>C(f))},[]);const c=F(Ct),[d,g]=h.exports.useState(),[x,C]=h.exports.useState({});return p(O,{children:[s(ka,{}),p("div",{style:{backgroundColor:"#fff",height:"calc(100vh - 48px)",width:"100vw",position:"relative",display:"grid",gridTemplateColumns:`${t+1}px 1fr`},children:[e===0&&p("div",{className:"opening-tab",children:[s("div",{style:{fontWeight:600,fontSize:14,height:60,alignItems:"center",display:"inline-flex",paddingLeft:24,columnGap:8,paddingTop:12},children:s(G,{children:"\u65B0\u5EFA"})}),s("input",{type:"file",accept:".json",style:{display:"none"},ref:r,onChange:async f=>{const m=f.target.files,N=m==null?void 0:m.item(0);if(N){const S=new Date().getTime(),E=JSON.parse(await N.text());E.name=`${E.name}\u2009-\u2009\u5BFC\u5165\u81EA\u201C${N.name}\u201D`,E.id=j(),E.createTime=S,E.lastEditTime=S,i(Sa(E,()=>l(`file?fileId=${E.id}`,{state:{fileId:E.id}})))}}}),p("div",{style:{display:"grid",columnGap:16,rowGap:16,padding:"8px 24px 24px 24px",gridTemplateColumns:"repeat(auto-fit, 280px)"},children:[p(Et,{onClick:f=>a("create"),children:[s("img",{src:"/static/file.svg",width:48,height:48}),p("div",{children:[s("span",{className:"truncate",style:{display:"block"},children:"\u65B0\u5EFA\u67E5\u8BE2"}),s("span",{className:"truncate",style:{display:"block",color:"var(--grey200)",fontSize:12,fontWeight:400},children:"\u6784\u5EFA\u65B0\u7684\u67E5\u8BE2\u6761\u4EF6"})]})]}),p(Et,{onClick:f=>{var m;(m=r==null?void 0:r.current)==null||m.click()},children:[s("img",{src:"/static/import.svg",width:48,height:48}),p("div",{children:[s("span",{className:"truncate",style:{display:"block"},children:"\u4ECE\u6587\u4EF6\u5BFC\u5165"}),s("span",{className:"truncate",style:{display:"block",color:"var(--grey200)",fontSize:12,fontWeight:400},children:"\u4ECE\u2009JSON\u2009\u6587\u4EF6\u5BFC\u5165\u67E5\u8BE2\u6761\u4EF6"})]})]})]}),d&&p(ee,{target:d.event,directionalHint:re.bottomLeftEdge,onDismiss:f=>g(void 0),theme:Y,beakWidth:0,calloutMaxWidth:320,styles:{calloutMain:{borderRadius:0,padding:"8px 0",minWidth:180}},children:[s("div",{className:"contextual-callout-item",children:s("div",{children:"\u67E5\u8BE2\u5339\u914D\u7ED3\u679C"})}),s("div",{className:"contextual-callout-sep"}),s("div",{className:"contextual-callout-item",onClick:async f=>{g(void 0)},children:s("div",{children:"\u91CD\u547D\u540D"})}),s("div",{className:"contextual-callout-item",onClick:f=>{ie.removeItem(d.file.id),i(Ca(d.file)),g(void 0)},children:s("div",{children:"\u5220\u9664"})})]}),c.map(f=>p(te.Fragment,{children:[p("div",{style:{fontWeight:600,fontSize:14,height:72,alignItems:"center",display:"inline-flex",paddingLeft:24,columnGap:8,paddingTop:24},children:[s(G,{children:f.dataSource.name}),s(G,{style:{color:"var(--grey200)",fontWeight:600,fontFamily:"var(--mono-font)"},children:`${f.dataSource.mongo.hostAddress}:${f.dataSource.mongo.port}`})]}),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, 280px)",rowGap:16,width:"100%",columnGap:16,padding:"8px 24px 24px"},children:$.sortBy(f.queries,m=>-m.createTime).map(m=>p(Pa,{onClick:N=>{l(`file?fileId=${m.id}`,{state:{fileId:m.id}})},onContextMenu:N=>{g({event:N.nativeEvent,file:m}),N.preventDefault()},children:[s("div",{style:{background:"var(--grey50)",width:"calc(100% + 32px)",height:"calc(100% + 8px)",margin:"-16px -16px 0 -16px"},children:s(Ba,{file:m})}),s(G,{children:m.name}),s("span",{style:{fontSize:12,fontWeight:400,color:"var(--grey200)"},children:X.spacing(`${m.lastEditTime===m.createTime?"\u521B\u5EFA":"\u4FEE\u6539"}\u4E8E${En.format(m.lastEditTime)}`)})]},m.id))})]},f.dataSource.id))]}),e===1&&p("div",{className:"opening-tab",children:[s("div",{style:{fontWeight:600,fontSize:14,height:60,alignItems:"center",display:"flex",paddingLeft:24,columnGap:8,paddingTop:24},children:s(G,{children:"\u67E5\u8BE2\u5386\u53F2"})}),Object.keys(x).map(f=>{var m,N;return s(O,{children:p("div",{style:{fontWeight:500,fontSize:14,height:72,alignItems:"center",display:"flex",paddingLeft:24,columnGap:42,paddingTop:24},children:[s(G,{children:(N=(m=c.flatMap(S=>S.queries).find(S=>S.id===f))==null?void 0:m.name)!=null?N:""}),s(G,{style:{color:"var(--grey200)",fontWeight:500},children:`${En.format(x[f].queryTimestamp)}\uFF0C${x[f].solutions.length}\u4E2A\u7ED3\u679C`})]})})})]}),e===2&&s("div",{className:"opening-tab",children:s("div",{})})]}),o==="create"&&s(Ta,{onDismiss:()=>a(void 0)}),o==="connect"&&s(_a,{onDismiss:()=>a(void 0)})]})}const Ma=()=>s(eo,{children:p(to,{children:[s(Tt,{path:"/",element:s($a,{})}),s(Tt,{path:"file",element:s(Fa,{})})]})}),La=no({reducer:{nodes:Co,edges:mo,constraints:go,workspace:Go,overview:wa}});oo.render(s(te.StrictMode,{children:s(so,{theme:ws,children:s(ao,{store:La,children:s(Ma,{})})})}),document.getElementById("ideograph-app"));
